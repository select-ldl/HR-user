(window.webpackJsonp=window.webpackJsonp||[]).push([[78],{29784:function(e,t,o){"use strict";o.r(t),function(e){o.d(t,"default",(function(){return C}));var r,a,i,n,l,s,c=o(7113),h=o.n(c),g=o(1656),d=o(11405),p=o(12862),u=o(6879),m=o(11320);o(13156);function y(){return y=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var o=arguments[t];for(var r in o)Object.prototype.hasOwnProperty.call(o,r)&&(e[r]=o[r])}return e},y.apply(this,arguments)}function b(e,t,o,r){o&&Object.defineProperty(e,t,{enumerable:o.enumerable,configurable:o.configurable,writable:o.writable,value:o.initializer?o.initializer.call(r):void 0})}function f(e,t,o,r,a){var i={};return Object.keys(r).forEach((function(e){i[e]=r[e]})),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=o.slice().reverse().reduce((function(o,r){return r(e,t,o)||o}),i),a&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(a):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(e,t,i),i=null),i}let C=(a=f((r=class{constructor(){b(this,"schemaChangelog",a,this),b(this,"collectionChangelogStores",i,this),b(this,"model",n,this),b(this,"isSchemaLoadingMore",l,this),b(this,"isSchemaLoadingMoreError",s,this)}async fetchChangelog(t){try{this.setCollectionChangelogStores([]),this.schemaChangelog=null,this.setIsSchemaLoadingMore(!1),this.setIsSchemaLoadingMoreError(null),this.model=t;let o=[],r=[],a=this.handleFetchSchemaChangelog(t);r.push(a),this.handleFetchCollectionChangelog(t,r);const i=await Promise.all(r);this.schemaChangelog=e.head(i),o=this.schemaChangelog.data.map((e=>y({},e,{changeType:"schema",enableRestore:!1}))),e.map(this.collectionChangelogStores,(t=>{const r=e.map(e.get(t,"feeds",[]),(o=>y({},o,{changeType:"collection",meta:t.meta,collectionUid:e.get(t,"collectionUid"),enableRestore:!1})));o=e.concat(o,r)})),o=e.chain(o).sortBy("createdAt").reverse().value();const n=await u.default.getAllReleases(e.get(t,"api.id"),e.get(t,"apiVersion.id"),"gitTag"),l=this.groupChangesByRelease(o,n);return e.find(l,(o=>o.id===e.get(t,"activeRelease.id")))}catch(e){Object(m.default)(e,"Something went wrong while fetching changelog")}}groupChangesByRelease(t,o){let r=e.chain(o).sortBy("createdAt").reverse().value();r.unshift({name:"Unreleased Changes",id:"unreleasedChanges"});let a=0,i=0;for(;a<t.length;){const e=t[a],o=r[i],n=r[i+1];i===r.length-1||e.createdAt>n.createdAt?(o.changelog?o.changelog.push(e):o.changelog=[e],a++):i++}return r=r.map((e=>y({},e,{changesGroupedByDate:h.a.getDateGroups(e.changelog,"createdAt","MMMM D, YYYY")}))),r}handleFetchSchemaChangelog(t,o=null){const r=e.get(t,"activeRelease.entities.schemas[0].entityId");return r?Object(d.fetchChangelog)(r,o):Promise.resolve({data:[]})}fetchCollectionIds(t){const o=new Set;return e.map(e.get(this.model,"activeRelease.entities"),(t=>{e.map(t,(e=>{o.add(e.entityId)}))})),Array.from(o)}handleFetchCollectionChangelog(t,o){e.map(this.fetchCollectionIds(),(e=>{const t=new p.default;o.push(t.initialize(e)),this.collectionChangelogStores.push(t)}))}get isLoadingMore(){return!e.every(this.collectionChangelogStores,{isLoadingMore:!1})||this.isSchemaLoadingMore}get isLoaded(){let t=!0;for(let o of this.collectionChangelogStores)t=t&&0===e.get(o,"meta.next_max_id");return t&&!e.get(this.schemaChangelog,"meta.cursor.next")}get loadMoreError(){for(let t of this.collectionChangelogStores)if("loadMore"===e.get(t,"error.type"))return t.error;if(this.isSchemaLoadingMoreError)return y({},this.isSchemaLoadingMoreError,{type:"loadMore"})}setIsSchemaLoadingMore(e){this.isSchemaLoadingMore=e}setIsSchemaLoadingMoreError(e){this.isSchemaLoadingMoreError=e}setCollectionChangelogStores(e){this.collectionChangelogStores=e}async loadMore(){try{if(this.isLoaded||this.isLoadingMore)return;this.setIsSchemaLoadingMore(!0),this.setIsSchemaLoadingMoreError(null);let t=null;try{if(e.get(this.schemaChangelog,"meta.cursor.next")){const t=await this.handleFetchSchemaChangelog(this.model,e.get(this,"schemaChangelog.meta.cursor.next")),o=e.concat(e.get(t,"data",[]),e.get(this.schemaChangelog,"data",[]));this.schemaChangelog=Object.assign({},t,{data:o})}t=this.schemaChangelog.data.map((e=>y({},e,{changeType:"schema",enableRestore:!1})))}catch(e){throw this.setIsSchemaLoadingMoreError(y({},e,{entityType:"schema"})),e}e.forEach(this.collectionChangelogStores,(async t=>{if(e.get(t,"loadMore"))try{await t.loadMore()}catch(e){throw e}})),e.map(this.collectionChangelogStores,(o=>{const r=e.map(e.get(o,"feeds",[]),(t=>y({},t,{changeType:"collection",meta:o.meta,collectionUid:e.get(o,"collectionUid"),enableRestore:!1})));t=e.concat(t,r)})),t=e.chain(t).sortBy("createdAt").reverse().value();const o=await u.default.getAllReleases(e.get(this.model,"api.id"),e.get(this.model,"apiVersion.id"),"gitTag"),r=this.groupChangesByRelease(t,o),a=e.find(r,(t=>t.id===e.get(this.model,"activeRelease.id")));return this.setIsSchemaLoadingMore(!1),a}catch(e){Object(m.default)(e,"There was an unexpected error while loading more changes")}}}).prototype,"schemaChangelog",[g.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),i=f(r.prototype,"collectionChangelogStores",[g.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),n=f(r.prototype,"model",[g.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),l=f(r.prototype,"isSchemaLoadingMore",[g.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),s=f(r.prototype,"isSchemaLoadingMoreError",[g.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),f(r.prototype,"handleFetchCollectionChangelog",[g.action],Object.getOwnPropertyDescriptor(r.prototype,"handleFetchCollectionChangelog"),r.prototype),f(r.prototype,"isLoadingMore",[g.computed],Object.getOwnPropertyDescriptor(r.prototype,"isLoadingMore"),r.prototype),f(r.prototype,"isLoaded",[g.computed],Object.getOwnPropertyDescriptor(r.prototype,"isLoaded"),r.prototype),f(r.prototype,"loadMoreError",[g.computed],Object.getOwnPropertyDescriptor(r.prototype,"loadMoreError"),r.prototype),f(r.prototype,"setIsSchemaLoadingMore",[g.action],Object.getOwnPropertyDescriptor(r.prototype,"setIsSchemaLoadingMore"),r.prototype),f(r.prototype,"setIsSchemaLoadingMoreError",[g.action],Object.getOwnPropertyDescriptor(r.prototype,"setIsSchemaLoadingMoreError"),r.prototype),f(r.prototype,"setCollectionChangelogStores",[g.action],Object.getOwnPropertyDescriptor(r.prototype,"setCollectionChangelogStores"),r.prototype),r)}.call(this,o(2753))}}]);