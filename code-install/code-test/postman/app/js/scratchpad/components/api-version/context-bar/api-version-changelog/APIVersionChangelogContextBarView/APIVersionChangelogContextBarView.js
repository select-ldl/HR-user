(window.webpackJsonp=window.webpackJsonp||[]).push([[73],{29768:function(e,t,a){"use strict";a.r(t),function(e){a.d(t,"default",(function(){return w}));var s,i=a(2),n=a.n(i),l=a(2353),o=a(1656),r=a(2825),d=a.n(r),c=a(7326),h=a(29769),p=a(7121),g=a(5929),u=a(9),m=a(7124),f=a(29772),D=a(29771),y=a(11226),E=a(11224),R=a(11227),b=a(7307),S=a(2765),C=a(2778),I=a(24818),x=a(11643),O=a(11211);let w=Object(l.observer)(s=class extends i.Component{constructor(t){super(t),this.state={releaseGroups:[],isLoading:!0,loadingErr:!1,isEditReleaseOpen:!1,releaseName:"",releaseDescription:"",releaseToEdit:null,isDeleteReleaseOpen:!1,releaseToDelete:null,releaseVisibility:!1,configuredIntegration:null,loadingIntegration:!1,APIGatewayDeployText:"Deploy Schema"},this.fetchChangelogs=this.fetchChangelogs.bind(this),this.setEditReleaseModalOpen=this.setEditReleaseModalOpen.bind(this),this.setDeleteReleaseModalOpen=this.setDeleteReleaseModalOpen.bind(this),this.handleScroll=this.handleScroll.bind(this),this.handleScrollDebounced=e.debounce(this.handleScroll,100),this.loadMoreChanges=this.loadMoreChanges.bind(this),this.fetchDeployOptionContext=this.fetchDeployOptionContext.bind(this),this.handleDeploySchemaClick=this.handleDeploySchemaClick.bind(this)}componentDidMount(){this.fetchChangelogs(),this.fetchDeployOptionContext(),this.isReleaseChanging=Object(o.reaction)((()=>e.get(this.props,"contextData.model.isLoadingAddRelease")||e.get(this.props,"contextData.model.isUpdatingRelease")||e.get(this.props,"contextData.model.isUpdatingReleases")),(e=>{e||this.fetchChangelogs()}))}componentWillUnmount(){this.isReleaseChanging&&this.isReleaseChanging()}fetchDeployOptionContext(){if(!x.default.shouldRenderGatewayIntegration(e.get(this.props,"contextData.model")))return!1;let t=e.get(this.props,"contextData.model.id");this.setState({loadingIntegration:!0}),x.default.getDeployOptionContext(t,((t,a)=>{this.setState({loadingIntegration:!1}),t||this.setState({configuredIntegration:e.get(a,"integration",null),APIGatewayDeployText:e.get(a,"deployString","Deploy Schema")})}))}handleDeploySchemaClick(t){const a=e.get(t,"entities.schemas.0.entityId"),s=e.get(t,"entities.schemas.0.tag"),i=e.get(t,"id"),n=e.get(t,"name"),l=e.get(this.props,"contextData.model.id"),o=e.get(this.props,"contextData.model.apiId"),r=e.get(this.state,"configuredIntegration.id");x.default.addDeployClickAnalytics(this.state.configuredIntegration,O.RELEASE_CONTEXTBAR),S.default.transitionTo("build.deployObservability",{apiId:o,versionId:l,integrationId:r},null,{additionalContext:{releaseId:i,schemaId:a,releaseName:n,tagId:s}})}handleScroll(){let t=this.refs.changelog_feed;if(t.scrollHeight-(t.scrollTop+t.offsetHeight)<=5){if(!e.isEmpty(e.get(this.props,"controller.loadMoreError"))||e.get(this.props,"controller.isLoaded")||!e.get(this.props,"controller.loadMore"))return;this.loadMoreChanges()}}loadMoreChanges(){return this.props.controller.loadMore().then((t=>{e.isEmpty(t)||this.setState({releaseGroups:t,isLoading:!1})}))}getRefreshTextClass(){return d()({"api-changelog-context-view-wrapper__refresh-button":!0,"api-changelog-context-view-wrapper__refresh-button__loading":this.state.isLoading})}getRefreshIconText(){return Object(g.getStore)("SyncStatusStore").isSocketConnected?this.state.isLoading?"Please wait...":"Refresh changelog":"Get online to perform this action"}fetchChangelogs(){this.setState({releaseGroups:[],isLoading:!0,loadingErr:!1}),Object(o.when)((()=>!e.get(this.props,"contextData.schemaLoading")),(()=>{this.props.controller.fetchChangelog(e.get(this.props,"contextData.model",{})).then((e=>{this.setState({releaseGroups:e,isLoading:!1})})).catch((e=>{this.setState({isLoading:!1,loadingErr:!0})}))}))}handleReleaseActionSelect(t,a){const s=e.get(t,"id"),i=e.get(t,"name"),n=e.get(t,"description"),l=e.get(t,"visibility");switch(a){case"edit":return C.default.addEventV2({category:"release",action:"initiate_edit",label:"changelog",value:1,entityId:s}),this.setEditReleaseModalOpen(!0,s,i,n,l);case"delete":return C.default.addEventV2({category:"release",action:"initiate_delete",label:"changelog",value:1,entityId:s}),this.setDeleteReleaseModalOpen(!0,s);case"deploy":return this.handleDeploySchemaClick(t)}}handleNameClick(t){const a=e.get(t,"id"),s=e.get(this.props,"contextData.model.id"),i=e.get(this.props,"contextData.model.apiId");"unreleasedChanges"!==a&&(C.default.addEventV2({category:"release",action:"view",label:"changelog",value:1,entityId:a}),e.get(this.props,"contextData.promoteTab")&&e.isFunction(this.props.contextData.promoteTab)&&this.props.contextData.promoteTab(),S.default.transitionTo("build.release",{apiId:i,apiVersionId:s,releaseId:`${a}`}))}renderViewRelease(t){if(!(t=>"unreleasedChanges"===e.get(t,"id"))(t))return n.a.createElement("div",{className:"api-changelog__content__view-release"},n.a.createElement(u.Button,{onClick:this.handleNameClick.bind(this,t),type:"plain",text:"View this release"}),n.a.createElement(u.IconDirectionForward,{className:"button-icon"}))}renderReleaseActions(t){const a=!e.get(this.props.contextData.model,"apiPermissionStore.canUpdateRelease"),s=!Object(g.getStore)("SyncStatusStore").isSocketConnected||a,{loadingIntegration:i,configuredIntegration:l,APIGatewayDeployText:o}=this.state;return n.a.createElement("div",null,n.a.createElement(b.Dropdown,{className:"api-changelog__header__release-actions__dropdown",onSelect:this.handleReleaseActionSelect.bind(this,t)},n.a.createElement(b.DropdownButton,{dropdownStyle:"nocaret",type:"custom"},n.a.createElement(u.Button,{type:"tertiary",icon:"icon-action-options-stroke",size:"small",className:"api-changelog__header__release-actions__dropdown__button"})),n.a.createElement(b.DropdownMenu,{"align-right":!0},i?n.a.createElement(b.MenuItem,{disabled:!0,refKey:"deploy"},n.a.createElement(p.default,null)):x.default.shouldRenderDeploy(l)&&x.default.shouldRenderGatewayIntegration(e.get(this.props,"contextData.model"))&&n.a.createElement(b.MenuItem,{refKey:"deploy",disabled:s,disabledText:Object(R.default)(s,!this.canUpdateRelease)},n.a.createElement("span",{title:o},x.default.truncate(o))),n.a.createElement(b.MenuItem,{disabled:s,disabledText:Object(R.default)(s,!this.canUpdateRelease),refKey:"edit"},n.a.createElement("span",null,"Edit")),n.a.createElement(b.MenuItem,{disabled:s,disabledText:Object(R.default)(s,!this.canUpdateRelease),refKey:"delete"},n.a.createElement("span",null,"Delete")))))}renderChangelog(){const t=!Object(g.getStore)("SyncStatusStore").isSocketConnected,a=e.get(this.props.contextData.model,"apiPermissionStore.canUpdateRelease");if(t&&this.state.isLoading)return n.a.createElement(D.default,null);if(this.state.isLoading)return n.a.createElement(p.default,null);if(this.state.loadingErr)return n.a.createElement(f.default,{onRetry:this.fetchChangelogs});const s=e.get(this.props,"contextData.model",{}),i=e.get(this.props,"controller.isLoadingMore"),l=e.get(this.props,"controller.loadMoreError",{});return n.a.createElement(n.a.Fragment,null,n.a.createElement("div",{className:"api-changelog",ref:"changelog_feed",onScroll:this.handleScrollDebounced},e.map(this.state.releaseGroups,((t,i)=>n.a.createElement(h.default,{model:s,release:t,promoteTab:e.get(this.props,"contextData.promoteTab"),setEditReleaseModalOpen:this.setEditReleaseModalOpen,setDeleteReleaseModalOpen:this.setDeleteReleaseModalOpen,canUpdateRelease:a,renderActions:this.renderReleaseActions.bind(this,t),renderViewRelease:this.renderViewRelease.bind(this,t),isLastRelease:i===e.get(this.state.releaseGroups,"length")-1,handleRefresh:this.fetchChangelogs})))),(i||!e.isEmpty(l))&&n.a.createElement(I.LoadFeed,{error:l,key:"loading-more",isLoading:i,isOffline:t,onRetry:this.loadMoreChanges}))}setEditReleaseModalOpen(e,t,a,s,i){this.setState({isEditReleaseOpen:e,releaseToEdit:t,releaseName:a,releaseDescription:s,releaseVisibility:i})}setDeleteReleaseModalOpen(e,t){this.setState({isDeleteReleaseOpen:e,releaseToDelete:t})}render(){const t=e.get(this.props,"contextData.model",{});return n.a.createElement("div",{className:"api-changelog-context-view-wrapper"},n.a.createElement(c.ContextBarViewHeader,{title:this.props.title,onClose:this.props.onClose},n.a.createElement(m.Button,{className:this.getRefreshTextClass(),tooltip:this.getRefreshIconText(),tooltipImmediate:!0,type:"tertiary",onClick:this.fetchChangelogs,disabled:this.state.isLoading||!Object(g.getStore)("SyncStatusStore").isSocketConnected},n.a.createElement(u.Icon,{name:"icon-action-refresh-stroke"}))),this.renderChangelog(),n.a.createElement(y.default,{origin:"changelog",isOpen:e.get(this.state,"isEditReleaseOpen"),releaseId:this.state.releaseToEdit,releaseName:this.state.releaseName,releaseVisibility:this.state.releaseVisibility,releaseDescription:this.state.releaseDescription,apiId:t.apiId,apiVersionId:e.get(t,"id"),model:t,toggleUpdateReleaseModal:this.setEditReleaseModalOpen}),n.a.createElement(E.default,{origin:"changelog",isOpen:e.get(this.state,"isDeleteReleaseOpen"),releaseId:this.state.releaseToDelete,apiId:t.apiId,apiVersionId:t.id,deleteReleaseHandler:t.deleteRelease,model:t,isDeletingRelease:e.get(t,"isDeletingRelease"),toggleDeleteReleaseModal:this.setDeleteReleaseModalOpen}))}})||s}.call(this,a(2753))}}]);