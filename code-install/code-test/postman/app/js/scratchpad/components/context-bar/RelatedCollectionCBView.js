(window.webpackJsonp=window.webpackJsonp||[]).push([[82],{34513:function(e,t,l){"use strict";l.r(t),function(e){l.d(t,"default",(function(){return I}));var o,a=l(2),i=l.n(a),c=l(2779),n=l.n(c),r=l(1656),s=l(2353),d=l(2825),m=l.n(d),h=l(9),u=l(7124),p=l(5929),_=l(7352),b=l(7121),C=l(12311),E=l(7148),g=l(2778),f=l(6917),y=l(34514),v=l(7350),N=l(2765);const k=l(47).default.p`
  font-size: ${e=>e.theme["text-size-m"]};
  line-height: 1.6;
  color: ${e=>e.theme["content-color-secondary"]};
  padding: 0px ${e=>e.theme["spacing-xl"]}
  `;let I=Object(s.observer)(o=class extends a.Component{constructor(t){super(t),this.handleCollectionFork=(e,t)=>{if(g.default.addEventV2AndPublish({category:"related",action:"fork",label:"collection-forked",value:t,entityType:"collection",entityId:e,traceId:this.traceId}),Object(p.getStore)("CurrentUserStore").isLoggedIn)return Object(f.collectionActions)(e,"fork",null,{origin:"request-contextbar"});pm.mediator.trigger("showSignInModal",{type:"fork",origin:"fork_collection_modal"})},this.state={isLoading:!0,relatedCollections:[],loadError:!1,loadEmpty:!1,hasMoreResults:!1,loadingMore:!1,requestUrl:"",currentOffset:0},this.traceId="",this.fetchRelatedCollections=e.debounce(this.fetchRelatedCollections.bind(this),1500),this.sanitizedCountPlaceholder=this.sanitizedCountPlaceholder.bind(this),this.getCollectionUrl=this.getCollectionUrl.bind(this),this.requestOrigin="contextBarRecommendation",this.handleCollectionFork=this.handleCollectionFork.bind(this),this.sanitizedCountPlaceholder=this.sanitizedCountPlaceholder.bind(this),this.hideForkInfo=!0,this.relatedCollectionsList=i.a.createRef(),this.handleScroll=e.debounce(this.handleScroll.bind(this),1e3)}componentDidMount(){const e=Object(p.getStore)("SearchStore").relatedCollectionsTraceId;this.traceId=e||n()();let{type:t,id:l}=this.props.contextData;g.default.addEventV2AndPublish({category:"related",action:"initiate",entityType:t,entityId:l,traceId:this.traceId}),this.disposePreviewReaction=Object(r.reaction)((()=>{let e=Object(p.getStore)("EditorStore").find(this.props.contextData.editorId),t=(e&&e.model).resourceToSave(),l=Object(p.getStore)("ActiveEnvironmentStore").id;return t.url+l}),(()=>{this.fetchRelatedCollections(this.props.contextData.editorId)})),this.fetchRelatedCollections(this.props.contextData.editorId)}componentWillUnmount(){this.disposePreviewReaction&&this.disposePreviewReaction(),e.invoke(this.relatedCollectionsList,"removeEventListener","scroll")}handleScroll(){this.relatedCollectionsList.scrollTop+this.relatedCollectionsList.clientHeight>=this.relatedCollectionsList.scrollHeight&&!this.state.loadingMore&&this.state.hasMoreResults&&this.loadMoreCollections()}loadMoreCollections(){this.setState({loadingMore:!0});const{requestUrl:t,currentOffset:l}=this.state;_.default.getRequestRelatedCollections(t,this.traceId,this.props.contextData.parentCollectionUid,this.requestOrigin,v.RELATED_COLLECTIONS_CB_COUNT,l).then((t=>{let o=e.get(t,"data",[]),a=this.state.relatedCollections;this.setState({relatedCollections:e.concat(a,o),hasMoreResults:t.meta.total>l+v.RELATED_COLLECTIONS_CB_COUNT,currentOffset:l+v.RELATED_COLLECTIONS_CB_COUNT,loadingMore:!1})})).catch((e=>{pm.logger.error("RelatedCollectionCBView~loadMoreCollections: Failed to fetch more related collections"),this.setState({loadingMore:!1})}))}sanitizedCountPlaceholder(t,l){return e.isUndefined(t)&&(t=0),`${t=C.default.convertToUserFriendlyMetric(t)} ${l}`}fetchRelatedCollections(t){this.props.controller.getResolvedRequest(t).then((e=>{if(e===this.state.requestUrl)throw new Error("sameRequest");return this.setState({isLoading:!0,loadError:!1,relatedCollections:[],requestUrl:e}),""===e||0===e.length?{}:_.default.getRequestRelatedCollections(e,this.traceId,this.props.contextData.parentCollectionUid,this.requestOrigin,v.RELATED_COLLECTIONS_CB_COUNT)})).then((t=>{let l=e.get(t,"data",[]);if(0===l.length)this.setState({relatedCollections:[],isLoading:!1});else{let{type:o,id:a}=this.props.contextData;g.default.addEventV2AndPublish({category:"related",action:"view",value:l.length,entityType:o,entityId:a,traceId:this.traceId}),this.setState({relatedCollections:l,isLoading:!1,currentOffset:v.RELATED_COLLECTIONS_CB_COUNT,hasMoreResults:t.meta.total>v.RELATED_COLLECTIONS_CB_COUNT},(()=>{e.isFunction(this.relatedCollectionsList.addEventListener)&&this.relatedCollectionsList.addEventListener("scroll",this.handleScroll)}))}})).catch((e=>{"sameRequest"===!e.message?(pm.logger.error("RelatedCollectionCBView~fetchRelatedCollections: Failed to fetch related collections"),this.setState({relatedCollections:[],isLoading:!1,loadError:!0})):this.setState({isLoading:!1})}))}getCollectionUrl(t){const{publisherHandle:l,workspaces:o}=t,a=e.get(o,"0.slug");return l&&a?`${window.postman_explore_url}/${l}/workspace/${a}/collection/${t.id}`:`${window.postman_explore_url}/v1/backend/redirect?type=${t.entityType}&id=${t.id}&publisherType=${t.publisherType}&publisherId=${t.publisherId}`}getCollectionList(e){if(0===e.length)return;let{type:t,id:l}=this.props.contextData;return i.a.createElement("div",{className:"related-collections-cb__list",ref:e=>this.relatedCollectionsList=e},e.map(((e,t)=>{const l=e.document,o=this.getCollectionUrl(l);return i.a.createElement(y.default,{key:t,collection:l,redirectUrl:o,sanitizedCountPlaceholder:this.sanitizedCountPlaceholder,hideForkInfo:this.hideForkInfo,traceId:this.traceId,contextData:this.props.contextData,handleCollectionFork:this.handleCollectionFork,index:t})})),this.state.loadingMore&&i.a.createElement("div",{className:"related-collections-cb__list-load-more"},i.a.createElement(b.default,null)),i.a.createElement("div",{className:"related-collections-cb__list-footer"},i.a.createElement("div",null,"Explore more collections on the "),i.a.createElement("div",{type:"link-subtle"},i.a.createElement(E.default,{to:`${window.postman_explore_redirect_url}/collections`,className:"lead-link",onClick:()=>{g.default.addEventV2AndPublish({category:"related",action:"click",label:"explore",entityType:t,entityId:l,traceId:this.traceId})}},"Public API Network")),"."))}getErrorState(){let e=this.props.contextData.editorId;return i.a.createElement("div",{className:"related-collections-cb__error"},i.a.createElement(h.BlankState,{className:"related-collections-cb__error-state-component",title:"Couldn't load related collections",description:"Couldn't load related collections. Try reloading.",primaryAction:i.a.createElement(h.Button,{type:"outline",text:"Reload",onClick:()=>this.fetchRelatedCollections(e)})},i.a.createElement(h.IllustrationInternalServerError,null)))}getEmptyState(){return i.a.createElement("div",{className:"related-collections-cb__empty-state"},i.a.createElement(h.BlankState,{className:"related-collections-cb__empty-state-component",title:"No related collections",description:i.a.createElement(k,null,"Try a different request or explore collections on the ",i.a.createElement(h.Button,{type:"monochrome-plain",onClick:()=>{N.default.openURL(`${window.postman_explore_redirect_url}/collections`)},text:"Public API Network"}))},i.a.createElement(h.IllustrationNoCollection,null)))}render(){let{isLoading:e,relatedCollections:t,loadError:l}=this.state;return i.a.createElement("div",{className:"related-collections-cb"},i.a.createElement("div",{className:m()("right-context-bar-header",this.props.className)},i.a.createElement("span",{className:"right-context-bar__title"},this.props.title,i.a.createElement(h.Badge,{status:"info",text:"beta",className:"related-collections-cb-badge"})),i.a.createElement("div",{className:"right-context__actions-container"},this.props.children,i.a.createElement(u.Button,{className:"context-bar-actions__button",type:"tertiary",onClick:this.props.onClose},i.a.createElement(h.Icon,{name:"icon-action-close-stroke",className:"right-context-bar__close-icon"})))),e?i.a.createElement("div",{className:"related-collections-cb__loader"},i.a.createElement(b.default,{className:"related-collections-cb__loader-item"})):l?this.getErrorState():t.length>0?i.a.createElement("div",{className:"related-collections-cb__container"},i.a.createElement("div",{className:"related-collections-cb__subheading"},i.a.createElement(h.Text,{type:"body-medium",color:"content-color-secondary"},"Discover public collections that best match your request")),this.getCollectionList(t)):this.getEmptyState())}})||o}.call(this,l(2753))},34514:function(e,t,l){"use strict";l.r(t),function(e){l.d(t,"default",(function(){return d}));var o=l(2),a=l.n(o),i=l(9),c=l(7148),n=l(2778),r=l(9564),s=l(5929);function d(t){const{collection:{id:l,name:o,publisherName:d,workspaces:m,views:h,forkLabel:u},redirectUrl:p,index:_}=t;return a.a.createElement("div",{className:"related-collections-cb__list-item"},a.a.createElement("div",{className:"related-collections-cb__list-item-details"},a.a.createElement("div",{className:"related-collections-cb__list-item-profile-icon"}),a.a.createElement("div",{className:"related-collections-cb__list-item-info"},a.a.createElement("div",{className:"related-collections-cb__list-item-title-wrapper"},a.a.createElement(i.Text,{color:"content-color-primary"},a.a.createElement(i.Text,{type:"link-subtle",className:"related-collections-cb__list-item-title"},a.a.createElement(c.default,{to:p,onClick:e=>{n.default.addEventV2AndPublish({category:"related",action:"view-collection",value:_,label:"public-collection",entityType:"collection",entityId:l,traceId:t.traceId})}},o)))),a.a.createElement("div",{className:"related-collections-cb__list-item-meta"},a.a.createElement("div",{className:"related-collections-cb__list-item-meta-row"},u&&a.a.createElement("div",{className:"related-collections-cb__list-item-fork-label"},a.a.createElement(i.Icon,{name:"icon-action-fork-stroke-small",color:"content-color-secondary",size:"small",className:"related-collections-cb__list-item-fork-label-icon"}),a.a.createElement("div",{className:"related-collections-cb__list-item-fork-label-text"},u))),a.a.createElement("div",{className:"related-collections-cb__list-item-meta-row"},a.a.createElement(i.Text,{type:"body-medium",color:"content-color-secondary"},d)),a.a.createElement("div",{className:"related-collections-cb__list-item-meta-row"},a.a.createElement(i.Icon,{name:"icon-action-view-stroke-small",color:"content-color-tertiary",size:"small",className:"related-collections-cb__list-item-meta-row-icon"}),a.a.createElement(i.Text,{type:"body-medium",color:"content-color-secondary"},t.sanitizedCountPlaceholder(h,"views")))))),a.a.createElement("div",{className:"related-collections-cb__list-item-fork-button"},a.a.createElement(r.ForkButton,{modelId:l,model:"collection",origin:"request-contextbar",disabled:!Object(s.getStore)("SyncStatusStore").isSocketConnected,disabledTooltip:"Get online to create a fork or view existing forks.",className:"related-collections-cb__list-item-fork-button",onFork:()=>t.handleCollectionFork(l,_),workspaceId:e.get(m,"0.id")})))}}.call(this,l(2753))}}]);