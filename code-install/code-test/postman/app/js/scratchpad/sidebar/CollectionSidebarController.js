(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{14506:function(e,t,i){"use strict";i.r(t),function(e){i.d(t,"default",(function(){return f}));var r,s,o=i(1656),a=i(1662),n=i(2284),l=i(14488),d=i(3686),c=i(3682),u=i(5439),b=i(5446),h=i(14507),p=i(3801),m=i(2310),S=i(3179);function g(e,t,i,r,s){var o={};return Object.keys(r).forEach((function(e){o[e]=r[e]})),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=i.slice().reverse().reduce((function(i,r){return r(e,t,i)||i}),o),s&&void 0!==o.initializer&&(o.value=o.initializer?o.initializer.call(s):void 0,o.initializer=void 0),void 0===o.initializer&&(Object.defineProperty(e,t,o),o=null),o}let f=(s=g((r=class{constructor(){var e,t,i,r;this.model=null,this._adapters=[],e=this,t="status",r=this,(i=s)&&Object.defineProperty(e,t,{enumerable:i.enumerable,configurable:i.configurable,writable:i.writable,value:i.initializer?i.initializer.call(r):void 0})}async didCreate(){if(this.model=new l.default,"browser"===window.SDK_PLATFORM){try{await this._loadFromListingAPIAdapter()}catch(e){return pm.logger.error("CollectionSidebarController~didCreate: Error in loading collection list from listing API",e),this.setSidebarStatus(p.ERROR)}return this.setSidebarStatus(p.READY)}try{this.setSidebarStatus(p.READY),await this._loadFromModelEventsAdapter()}catch(e){return pm.logger.error("CollectionSidebarController~didCreate: Error in loading collections from model events",e),this.setSidebarStatus(p.ERROR)}return this.setSidebarStatus(p.READY)}beforeDestroy(){this._adapters&&this._adapters.forEach((t=>{e.isFunction(t.dispose)&&t.dispose()})),this.model=null,this._adapters=[]}setSidebarStatus(e){this.status=e}async _fetchCollections(){await Object(a.getStore)("SyncStatusStore").onSyncAvailable();const t=Object(a.getStore)("ActiveWorkspaceStore").id,i=await m.RemoteSyncRequestService.request(S.COLLECTION_LIST`${t}`,{method:"POST",timeout:3e4}),r=e.forEach(e.get(i,"body.data",[]),(t=>{const i={model:"collection",modelId:t.id,action:"UPDATE_COLLECTION"},r=n.default.getCompositeKey(i);!Object(a.getStore)("PermissionStore").members.has(r)&&e.set(t,"attributes.permissions.userCanUpdate",!0)}));return this.model.hydrate&&this.model.hydrate(r),r}async _loadFromModelEventsAdapter(){const e=Object(a.getStore)("ActiveWorkspaceStore").id,t=new d.default(this.model.getCollectionAdapterModel(),{activeWorkspace:e,useUID:!0}),i=new c.default(this.model.getFolderAdapterModel()),r=new u.default(this.model.getRequestAdapterModel()),s=[t.hydrate(),i.hydrate(),r.hydrate()];this._adapters.push(t,i,r),await Promise.all(s),this.setSidebarStatus(p.READY);const o=new b.default(this.model.getResponseAdapterModel());this._adapters.push(o),await o.hydrate()}async _loadFromListingAPIAdapter(){const e=new h.default(this.model.getCollectionAdapterModel());this._adapters.push(e),await e.hydrate()}}).prototype,"status",[o.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return p.LOADING}}),g(r.prototype,"setSidebarStatus",[o.action],Object.getOwnPropertyDescriptor(r.prototype,"setSidebarStatus"),r.prototype),r)}.call(this,i(574))},14507:function(e,t,i){"use strict";i.r(t),function(e){i.d(t,"default",(function(){return l}));var r=i(1662),s=i(1677),o=i(1683),a=i(3179),n=i(14508);class l extends n.default{getListAndSubscribeAPIEndpoint(){const e=Object(r.getStore)("ActiveWorkspaceStore").id;return a.COLLECTION_LIST_AND_SUBSCRIBE`${e}`}getListAPIEndpoint(){const e=Object(r.getStore)("ActiveWorkspaceStore").id;return a.COLLECTION_LIST`${e}`}dispose(){super.dispose(),this.unsubscribeModelEvents&&this.unsubscribeModelEvents()}_subscribeToChangeEvents(t){super._subscribeToChangeEvents(t),this.unsubscribeModelEvents&&this.unsubscribeModelEvents(),this.unsubscribeModelEvents=null,this.unsubscribeModelEvents=pm.eventBus.channel("model-events").subscribe((t=>{if("collection"!==Object(s.getEventNamespace)(t))return;const i=Object(s.getEventName)(t);if(!["favorite","unfavorite"].includes(i))return;const r=Object(s.getEventData)(t),a=e.get(r,"collection.id"),n=e.get(r,"collection.owner"),l=Object(o.composeUID)(a,n),d="favorite"===i;this.model.updateFavorite&&this.model.updateFavorite(l,d)}))}}}.call(this,i(574))},14508:function(e,t,i){"use strict";i.r(t),function(e){i.d(t,"default",(function(){return l}));var r=i(1951),s=i(1860),o=i(14509),a=i(1662),n=i(3684);class l extends n.default{getListAndSubscribeAPIEndpoint(){throw new Error(`${this.constructor.name}~getListAndSubscribeAPIEndpoint: not implemented`)}getListAPIEndpoint(){throw new Error(`${this.constructor.name}~getListAPIEndpoint: not implemented`)}hydrate(t=!0){return new Promise(((i,s)=>{this._connection_subscription=Object(r.getSocketConnectionObservable)().subscribe((r=>{if("connect"===r)return this._getAPIResponse().then((i=>{const r=e.get(i,"body.data",[]),s=e.get(i,"body.subscription.id");this._hydrateEntities(r),t&&s&&this._subscribeToChangeEvents(s)})).then((()=>i())).catch((e=>(pm.logger.warn("ListingAPIAdapter~hydrate: Failed to hydrate entities",e),s(e))))}))}))}dispose(){super.dispose(),this._connection_subscription&&this._connection_subscription.unsubscribe(),this._realtime_subscription&&this._realtime_subscription.unsubscribe()}_hydrateEntities(e){this.model.hydrate&&this.model.hydrate(e)}_removeEntities(t){e.isEmpty(t)||this.model.remove&&this.model.remove(t)}_addEntities(t){e.isEmpty(t)||this.model.add&&this.model.add(t)}async _getAPIResponse(){return await Object(a.getStore)("SyncStatusStore").onSyncAvailable(),s.default.request(this.getListAndSubscribeAPIEndpoint(),{method:"POST",timeout:3e4})}_subscribeToChangeEvents(t){this._realtime_subscription&&this._realtime_subscription.unsubscribe(),this._realtime_subscription=Object(o.realtimeEventsForSubscription)(t).subscribe((t=>{const i=e.get(t,"data.data",[]),r=i.filter((({action:e})=>["create","update"].includes(e))).map((({id:e})=>e)),s=i.filter((({action:e})=>"delete"===e)).map((({id:e})=>e));this._removeEntities(s),this._createOrUpdateEntities(r)}))}async _createOrUpdateEntities(t){if(e.isEmpty(t))return;await Object(a.getStore)("SyncStatusStore").onSyncAvailable();const i=await s.default.request(this.getListAPIEndpoint(),{method:"POST",data:{ids:t},timeout:3e4}),r=e.get(i,"body.data",[]);this._addEntities(r)}}}.call(this,i(574))},14509:function(e,t,i){"use strict";i.r(t),function(e){i.d(t,"realtimeEventsForSubscription",(function(){return o}));var r=i(2079),s=i(2181);function o(t){return Object(s.getRealtimeMessagesObservable)().pipe(Object(r.filter)((i=>e.get(i,"data.subscription.id")===t)))}}.call(this,i(574))},24679:function(e,t,i){"use strict";i.r(t),function(e){i.d(t,"default",(function(){return _}));var r,s,o=i(1656),a=i(5929),n=i(6406),l=i(5924),d=i.n(l),c=i(11325),u=i(6755),b=i(7772),h=i(12918),p=i(12919),m=i(6382),S=i(9059),g=i(6899),f=i(6376),y=i(6375),E=i(11826),v=i.n(E);function A(e,t,i,r,s){var o={};return Object.keys(r).forEach((function(e){o[e]=r[e]})),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=i.slice().reverse().reduce((function(i,r){return r(e,t,i)||i}),o),s&&void 0!==o.initializer&&(o.value=o.initializer?o.initializer.call(s):void 0,o.initializer=void 0),void 0===o.initializer&&(Object.defineProperty(e,t,o),o=null),o}let _=(s=A((r=class{constructor(){var e,t,i,r;this.model=null,this._adapters=[],e=this,t="status",r=this,(i=s)&&Object.defineProperty(e,t,{enumerable:i.enumerable,configurable:i.configurable,writable:i.writable,value:i.initializer?i.initializer.call(r):void 0})}async didCreate(){v.a.startTrace(E.CollectionPerformanceTraces.SIDEBAR),v.a.addMarker(E.CollectionPerformanceTraces.SIDEBAR,E.CollectionPerformanceMarkers.SIDEBAR_LOAD_START),this.model=new c.default;try{await this._loadFromListingAPI(),await this._loadExtensibleCollections(),this.setSidebarStatus(S.READY)}catch(e){pm.logger.error("CollectionSidebarController~didCreate: Failed to fetch collection list:",e)}v.a.addMarker(E.CollectionPerformanceTraces.SIDEBAR,E.CollectionPerformanceMarkers.SIDEBAR_LOAD_END),v.a.endTrace(E.CollectionPerformanceTraces.SIDEBAR),this.model.collectionList=await y.default.subscribe();const e=e=>e&&Object(a.getStore)("CollectionStore").find(Object(g.decomposeUID)(e).modelId);try{await Object(o.when)((()=>this.model.collectionList.ids.every(e)),{timeout:6e4})}catch(e){pm.logger.warn("CollectionSidebarController~didCreate: Timed out while waiting for store to be fully hydrated",e)}try{await this._loadFromModelEventsAdapter()}catch(e){return pm.logger.error("CollectionSidebarController~didCreate: Error in loading collections from model events",e),this.status===S.LOADING&&this.setSidebarStatus(S.ERROR)}return this.setSidebarStatus(S.READY)}beforeDestroy(){this._adapters&&this._adapters.forEach((t=>{e.isFunction(t.dispose)&&t.dispose()})),this.extensibleCollectionChangeListenersDisposer&&this.extensibleCollectionChangeListenersDisposer(),this.model=null,this._adapters=[]}setSidebarStatus(e){this.status=e}async _fetchCollections(){await Object(a.getStore)("SyncStatusStore").onSyncAvailable();const t=Object(a.getStore)("ActiveWorkspaceStore").id,i=await g.RemoteSyncRequestService.request(f.COLLECTION_LIST`${t}`,{method:"POST",timeout:3e4}),r=e.forEach(e.get(i,"body.data",[]),(t=>{const i={model:"collection",modelId:t.id,action:"UPDATE_COLLECTION"},r=n.default.getCompositeKey(i);!Object(a.getStore)("PermissionStore").members.has(r)&&e.set(t,"attributes.permissions.userCanUpdate",!0)}));return this.model.hydrate&&this.model.hydrate(r),r}async _loadExtensibleCollections(){let e;try{e=await d.a.list()}catch(e){pm.logger.error("CollectionSidebarController~_loadExtensibleCollections",e)}this.model.hydrateExtensibleCollection(e),this.extensibleCollectionChangeListenersDisposer=d.a.cacheAPI.subscribeToChanges(this.model.getExtensibleCollectionEventListeners())}async _loadFromListingAPI(){!function(t){if(e.isEmpty(t))return;const i=[],r=[],s=[],o=[];t.forEach((t=>{const a=e.get(t,"attributes.flags.isFavorite"),n=e.get(t,"attributes.permissions.teamCanView"),l=e.get(t,"attributes.permissions.anybodyCanView"),d=e.get(t,"attributes.flags.isArchived"),c=Object(g.decomposeUID)(t.id).modelId,u={id:c};a&&i.push(u),n&&r.push(u),l&&s.push({id:t.id}),d&&o.push({model:"collection",modelId:c})})),!e.isEmpty(i)&&Object(a.getStore)("FavoritedCollectionStore").add(i),!e.isEmpty(r)&&Object(a.getStore)("SharedCollectionsStore").add(r),!e.isEmpty(s)&&Object(a.getStore)("PublicEntityStore").add(s),!e.isEmpty(o)&&Object(a.getStore)("ArchivedResourceStore").add(o)}(await this._fetchCollections())}async _loadFromModelEventsAdapter(){const e=Object(a.getStore)("ActiveWorkspaceStore").id,t=new u.default(this.model.getCollectionAdapterModel(),{activeWorkspace:e,useUID:!0}),i=new b.default(this.model.getFolderAdapterModel()),r=new h.default(this.model.getRequestAdapterModel()),s=[t.hydrate(),i.hydrate(),r.hydrate()];this._adapters.push(t,i,r),await Promise.all(s),this.setSidebarStatus(S.READY);const o=new p.default(this.model.getResponseAdapterModel());this._adapters.push(o),await o.hydrate()}async _loadFromListingAPIAdapter(){const e=new m.default(this.model.getCollectionAdapterModel());this._adapters.push(e),await e.hydrate()}}).prototype,"status",[o.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return S.LOADING}}),A(r.prototype,"setSidebarStatus",[o.action],Object.getOwnPropertyDescriptor(r.prototype,"setSidebarStatus"),r.prototype),r)}.call(this,i(2753))}}]);