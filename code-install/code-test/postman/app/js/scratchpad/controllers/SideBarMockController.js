(window.webpackJsonp=window.webpackJsonp||[]).push([[31],{24580:function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return o}));var r=i(24581);class o{didCreate(){this.mockListStore=new r.default}beforeDestroy(){this.mockListStore&&this.mockListStore.cleanUp(),this.mockListStore=null}}},24581:function(e,t,i){"use strict";i.r(t),function(e){i.d(t,"default",(function(){return E}));var r,o,s,c,n,a,p,l,u,h,d,m,b,f,y,g,I=i(1656),v=i(5932),k=i(11312),O=i(5929),w=i(7757),S=i(8304),j=i(7320),M=i(2765),F=i(2778);function P(e,t,i,r){i&&Object.defineProperty(e,t,{enumerable:i.enumerable,configurable:i.configurable,writable:i.writable,value:i.initializer?i.initializer.call(r):void 0})}function D(e,t,i,r,o){var s={};return Object.keys(r).forEach((function(e){s[e]=r[e]})),s.enumerable=!!s.enumerable,s.configurable=!!s.configurable,("value"in s||s.initializer)&&(s.writable=!0),s=i.slice().reverse().reduce((function(i,r){return r(e,t,i)||i}),s),o&&void 0!==s.initializer&&(s.value=s.initializer?s.initializer.call(o):void 0,s.initializer=void 0),void 0===s.initializer&&(Object.defineProperty(e,t,s),s=null),s}let z=(r=class extends k.default{constructor(e){super(),this.id="",this.url="",P(this,"name",o,this),P(this,"private",s,this),P(this,"collection",c,this),P(this,"environment",n,this),P(this,"createdAt",a,this),P(this,"config",p,this),P(this,"createdBy",l,this),P(this,"active",u,this),this.id=e.id,this.url=e.url,this.update(e)}update(t){e.has(t,"name")&&(this.name=t.name),e.has(t,"published")&&(this.private=!t.published),e.has(t,"collection")&&(this.collection=t.collection),e.has(t,"environment")&&(this.environment=t.environment),e.has(t,"createdAt")&&(this.createdAt=t.createdAt),e.has(t,"config")&&(this.config=t.config),e.has(t,"createdBy")&&(this.createdBy=t.createdBy),e.has(t,"active")&&(this.active=t.active)}},o=D(r.prototype,"name",[I.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),s=D(r.prototype,"private",[I.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),c=D(r.prototype,"collection",[I.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return{}}}),n=D(r.prototype,"environment",[I.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return{}}}),a=D(r.prototype,"createdAt",[I.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),p=D(r.prototype,"config",[I.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return{}}}),l=D(r.prototype,"createdBy",[I.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return{}}}),u=D(r.prototype,"active",[I.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),D(r.prototype,"update",[I.action],Object.getOwnPropertyDescriptor(r.prototype,"update"),r.prototype),r),E=(h=class extends v.default{constructor(){super(z,{ignoreHydration:!0}),P(this,"errorFetchingMocks",d,this),P(this,"searchQuery",m,this),P(this,"permissions",b,this),P(this,"isOffline",f,this),P(this,"activeItem",y,this),P(this,"focusedItem",g,this),this.mockSubscriptionMap=new Map,this.syncStatusStoreReactionDisposer=null,this.setIsHydrating(!0);const t=Object(O.getStore)("SyncStatusStore");this.syncStatusStoreOfflineReactionDisposer=Object(I.reaction)((()=>t.isConsistentlyOffline),(e=>{e&&(this.isHydrating||this.errorFetchingMocks)&&this.setIsOffline(!0),e||this.setIsOffline(!1)}),{fireImmediately:!0}),this.syncStatusStoreSocketReactionDisposer=Object(I.reaction)((()=>t.isSocketConnected),(e=>{e&&(this.errorFetchingMocks?this.reload():this.hydrate()),e&&this.subscribeToWorkspaceRoom()}),{fireImmediately:!0}),Object(I.reaction)((()=>Object(O.getStore)("CurrentUserStore").isLoggedIn),(e=>{e&&this.reload()})),this.openMockDebounced=e.debounce(this.openMock,300)}setIsOffline(e){this.isOffline=e}cleanUp(){this.syncStatusStoreSocketReactionDisposer&&this.syncStatusStoreSocketReactionDisposer(),this.syncStatusStoreOfflineReactionDisposer&&this.syncStatusStoreOfflineReactionDisposer(),this.clear()}setActiveItem(e){e&&(this.activeItem=e)}resetActiveItem(){this.activeItem=null}setFocusedItem(e){e&&(this.focusedItem=e)}resetFocusedItem(){this.focusedItem=null}get activeItemIndex(){return e.findIndex(this.filteredItems,(e=>e.id===this.activeItem))}get focusedItemIndex(){return e.findIndex(this.filteredItems,(e=>e.id===this.focusedItem))}openMock(e){M.default.transitionTo("build.mock",{mockId:e},{},{additionalContext:{origin:"shortcut"}}),this.resetFocusedItem()}focusNext(){if(!this.activeItem)return;if(e.isEmpty(this.filteredItems))return this.resetActiveItem(),void this.resetFocusedItem();this.focusedItem||this.activeItem&&this.setFocusedItem(this.activeItem);const t=this.filteredItems[(this.focusedItemIndex+1)%this.filteredItems.length].id;this.setFocusedItem(t),this.openMockDebounced(t)}focusPrev(){if(!this.activeItem)return;if(e.isEmpty(this.filteredItems))return this.resetActiveItem(),void this.resetFocusedItem();this.focusedItem||this.activeItem&&this.setFocusedItem(this.activeItem);const t=this.filteredItems.length,i=this.filteredItems[((this.focusedItemIndex-1)%t+t)%t].id;this.setFocusedItem(i),this.openMockDebounced(i)}setSearchQuery(e){this.searchQuery=e}updatePermissions(e){this.permissions=e}reload(){this.setIsHydrating(!0),this.setErrorFetchingMocks(!1),this.clear(),this.hydrate()}hydrate(){return Object(w.getMocks)({workspace:Object(O.getStore)("ActiveWorkspaceStore").id,inactive:!0}).then((t=>{this.clear(),e.isEmpty(t)||(this.add(t),this.setPermissions(t))})).then((()=>{this.setErrorFetchingMocks(!1),this.setIsHydrating(!1)})).catch((e=>{this.setIsHydrating(!1),this.setErrorFetchingMocks(!0),pm.logger.warn("Failed to fetch Mocks List",e)}))}setPermissions(e){const t=Object(O.getStore)("CurrentUserStore").id;Object(j.default)(e,t).then((e=>{this.updatePermissions(e)})).catch((e=>{pm.logger.warn("Failed to get permissions",e)}))}setErrorFetchingMocks(t){!e.isNil(t)&&(this.errorFetchingMocks=t)}handleError(t,i){let r=e.get(t,"error.details.message")||e.get(t,"error.message")||i,o=e.get(t,"error.title"),s=e.get(t,"error.type");"Socket Disconnected"!==s&&"Request Timeout"!==s||(o="Something went wrong",r="Unable to complete this action. Please try again."),pm.toasts.error(r,{noIcon:!0,title:o})}updateName(e,t){e.name=t}rename(e,t={}){return Object(w.updateMock)(e).then((()=>{const i=this.find(e.id);this.updateName(i,e.name),F.default.addEventV2({category:"mock",action:"confirm_rename",label:t.origin,entityId:e.id})})).catch((i=>(this.handleError(i,"There was an unexpected error updating this Mock. Please try again."),F.default.addEventV2({category:"mock",action:"failure_rename",label:t.origin,entityId:e.id}),Promise.reject())))}get filteredItems(){const t=this.searchQuery.trim();if(!t)return this.values;let i=t.toLowerCase();return this.values.filter((t=>e.includes(t.name&&e.toLower(t.name),i)))}add(t){let i=e.isArray(t)?t:[t];super.add(i),e.forEach(i,(e=>{this.mockSubscriptionMap.has(e.id)||this.mockSubscriptionMap.set(e.id,this.subscribeToMockRoom(e.id))}))}remove(e){this.mockSubscriptionMap.has(e)&&(this.mockSubscriptionMap.get(e).unsubscribe(),this.mockSubscriptionMap.delete(e)),super.remove(e)}clear(){for(let e of this.mockSubscriptionMap.keys())this.mockSubscriptionMap.get(e).unsubscribe();this.mockSubscriptionMap.clear(),super.clear()}subscribeToWorkspaceRoom(){let t=Object(O.getStore)("ActiveWorkspaceStore").id;return Object(w.getAllRealtimeEvents)(t).subscribe((t=>{const i=e.get(t,"meta.model"),r=e.get(t,"meta.action"),o=e.get(t,"data"),s=Object(O.getStore)("CurrentUserStore").id;if(!e.isEmpty(i)&&"mock"===i)switch(r){case"create":Object(S.fetchMock)(o.mock,{populate:!0}).then((e=>{this.add(e)})).catch((e=>{pm.logger.warn("Failed to fetch Mock",e)})),Object(j.default)([{id:o.mock}],s).then((t=>{this.updatePermissions(e.assign({},this.permissions,t))})).catch((e=>{pm.logger.warn("Failed to get permission",e)}));break;case"addedToWorkspace":o.mock&&Object(S.fetchMock)(o.mock,{populate:!0}).then((e=>{this.add(e)})).catch((e=>{pm.logger.warn("Failed to fetch Mock",e)})),o.mock&&Object(j.default)([{id:o.mock}],s).then((t=>{this.updatePermissions(e.assign({},this.permissions,t))})).catch((e=>{pm.logger.warn("Failed to get permission",e)}))}}),(e=>pm.logger.warn("Failed to subscribe to workspace for mock events",e)))}subscribeToMockRoom(t){if(t)return Object(w.getAllRealtimeEvents)(null,t).subscribe((t=>{const i=e.get(t,"meta.model"),r=e.get(t,"meta.action"),o=e.get(t,"data");if(!e.isEmpty(i)&&"mock"===i)switch(r){case"update":Object(S.fetchMock)(o.mock,{populate:!0}).then((t=>{e.isEmpty(t)||this.find(t.id)&&this.update(t)})).catch((e=>{pm.logger.warn("Failed to fetch Mock",e)}));break;case"destroy":case"removedFromWorkspace":this.remove(o.mock);break;case"updateRoles":const t=Object(O.getStore)("CurrentUserStore").id;Object(j.default)([{id:o.mock}],t).then((t=>{this.updatePermissions(e.assign({},this.permissions,t))})).catch((e=>{pm.logger.warn("Failed to get permission",e)}))}}),(e=>pm.logger.warn("Failed to subscribe to mock room for events",e)))}},d=D(h.prototype,"errorFetchingMocks",[I.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),m=D(h.prototype,"searchQuery",[I.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),b=D(h.prototype,"permissions",[I.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return{}}}),f=D(h.prototype,"isOffline",[I.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),y=D(h.prototype,"activeItem",[I.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),g=D(h.prototype,"focusedItem",[I.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),D(h.prototype,"setIsOffline",[I.action],Object.getOwnPropertyDescriptor(h.prototype,"setIsOffline"),h.prototype),D(h.prototype,"cleanUp",[I.action],Object.getOwnPropertyDescriptor(h.prototype,"cleanUp"),h.prototype),D(h.prototype,"setActiveItem",[I.action],Object.getOwnPropertyDescriptor(h.prototype,"setActiveItem"),h.prototype),D(h.prototype,"resetActiveItem",[I.action],Object.getOwnPropertyDescriptor(h.prototype,"resetActiveItem"),h.prototype),D(h.prototype,"setFocusedItem",[I.action],Object.getOwnPropertyDescriptor(h.prototype,"setFocusedItem"),h.prototype),D(h.prototype,"resetFocusedItem",[I.action],Object.getOwnPropertyDescriptor(h.prototype,"resetFocusedItem"),h.prototype),D(h.prototype,"activeItemIndex",[I.computed],Object.getOwnPropertyDescriptor(h.prototype,"activeItemIndex"),h.prototype),D(h.prototype,"focusedItemIndex",[I.computed],Object.getOwnPropertyDescriptor(h.prototype,"focusedItemIndex"),h.prototype),D(h.prototype,"setSearchQuery",[I.action],Object.getOwnPropertyDescriptor(h.prototype,"setSearchQuery"),h.prototype),D(h.prototype,"updatePermissions",[I.action],Object.getOwnPropertyDescriptor(h.prototype,"updatePermissions"),h.prototype),D(h.prototype,"setErrorFetchingMocks",[I.action],Object.getOwnPropertyDescriptor(h.prototype,"setErrorFetchingMocks"),h.prototype),D(h.prototype,"updateName",[I.action],Object.getOwnPropertyDescriptor(h.prototype,"updateName"),h.prototype),D(h.prototype,"filteredItems",[I.computed],Object.getOwnPropertyDescriptor(h.prototype,"filteredItems"),h.prototype),D(h.prototype,"add",[I.action],Object.getOwnPropertyDescriptor(h.prototype,"add"),h.prototype),D(h.prototype,"remove",[I.action],Object.getOwnPropertyDescriptor(h.prototype,"remove"),h.prototype),D(h.prototype,"clear",[I.action],Object.getOwnPropertyDescriptor(h.prototype,"clear"),h.prototype),h)}.call(this,i(2753))}}]);