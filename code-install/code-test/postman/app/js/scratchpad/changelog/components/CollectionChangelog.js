(window.webpackJsonp=window.webpackJsonp||[]).push([[65],{24815:function(e,t,s){"use strict";s.r(t),function(e){s.d(t,"default",(function(){return b}));var i,n=s(2),o=s.n(n),a=s(9),l=s(2353),r=s(47),c=s(24816),d=s(5929),h=s(5950),p=s(7321),m=s(2778),g=s(6375),u=s(7326),y=s(1656);const v=r.default.div`
  height: 100%;
  position: relative;
`,f=r.default.div`
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
`;let b=Object(l.observer)(i=class extends n.Component{constructor(...t){super(...t),this.state={collection:null,isLoadingCollection:!1,errorLoadingCollection:!1},this.fetchCollection=()=>{if(!Object(d.getStore)("SyncStatusStore").isSocketConnected)return;this.setState({isLoadingCollection:!0});const t=Object(d.getStore)("ActiveWorkspaceStore").id;Object(g.getMeta)(t).then((t=>{const s=t.list.find((t=>t.uid===e.get(this.props,"contextData.collectionUid")));s?this.setState({collection:s,isLoadingCollection:!1}):this.setState({errorLoadingCollection:!0,isLoadingCollection:!1})})).catch((e=>{this.setState({errorLoadingCollection:!0,isLoadingCollection:!1})}))}}componentDidMount(){m.default.addEventV2({category:"collection",action:"view_changelog",label:"collection_context_bar",entityId:e.get(this.props,"contextData.collectionUid")}),this.disposeConnectionChangeReaction=Object(y.reaction)((()=>Object(d.getStore)("SyncStatusStore").isSocketConnected),(e=>{!this.state.collection&&e&&this.fetchCollection()}),{fireImmediately:!0})}componentWillUnmount(){this.disposeConnectionChangeReaction()}render(){const e=Object(d.getStore)("CurrentUserStore"),t=h.default.isProUser(e),s=Object(d.getStore)("SyncStatusStore").isSocketConnected,i=Object(d.getStore)("PermissionStore").can("restore","collection",this.props.contextData.id);return o.a.createElement(p.default,{identifier:"activityFeed"},!this.state.collection&&o.a.createElement(v,null,o.a.createElement(u.ContextBarViewHeader,{title:"Changelog",onClose:this.props.onClose}),o.a.createElement(f,null,this.state.isLoadingCollection&&o.a.createElement(a.Spinner,null),this.state.errorLoadingCollection&&o.a.createElement(a.BlankState,{title:"Unable to load the changelog",description:"Unable to find the collection.",primaryAction:o.a.createElement(a.Button,{type:"outline",text:"Try again",onClick:this.fetchCollection,isDisabled:!s,tooltip:!s&&"You can perform this action once you're back online"})},o.a.createElement(a.IllustrationPageNotFound,null)),!s&&o.a.createElement(a.BlankState,{title:"Check your connection",description:"Get online to view the changelog"},o.a.createElement(a.IllustrationCheckInternetConnection,null)))),this.state.collection&&o.a.createElement(c.default,{canAddVersionTag:this.state.collection.isEditable&&e.isLoggedIn,collectionUid:this.state.collection.uid,enableRestore:t&&i,key:this.state.collection.uid,title:this.props.title,isOffline:!s,isLoggedIn:e.isLoggedIn,onClose:this.props.onClose}))}})||i}.call(this,s(2753))},24816:function(e,t,s){"use strict";s.r(t),s.d(t,"default",(function(){return y}));var i=s(2),n=s.n(i),o=s(7113),a=s.n(o),l=s(24817),r=s(8343),c=s(24825),d=s(12862),h=s(2778),p=s(2789),m=s(5929),g=s(2825),u=s.n(g);class y extends i.Component{constructor(e){super(e),this.state={collectionRestoreTarget:null,openVersionTagModal:!1,isRemovingTag:!1,isRestored:!1},this.handleLoadNew=this.handleLoadNew.bind(this),this.handleLoadMore=this.handleLoadMore.bind(this),this.handleSignIn=this.handleSignIn.bind(this),this.handleRestore=this.handleRestore.bind(this),this.handleRetry=this.handleRetry.bind(this),this.handleAddVersionTag=this.handleAddVersionTag.bind(this),this.handleRemoveVersionTag=this.handleRemoveVersionTag.bind(this),this.handleVersionTagModalClose=this.handleVersionTagModalClose.bind(this)}UNSAFE_componentWillMount(){this.store=new d.default,this.props.isOffline||this.initializeFeeds(),this.subscribeToCollectionRestore()}componentWillUnmount(){this.unsubscribe&&"function"==typeof this.unsubscribe&&this.unsubscribe()}initializeFeeds(){let e=this.props.collectionUid;this.store.initialize(e)}handleLoadNew(){return this.store.loadNew().then((e=>Promise.resolve(e)))}handleLoadMore(){this.store.loadMore()}handleSignIn(){r.default.initiateLogin()}isWorkspaceMember(){return Object(m.getStore)("ActiveWorkspaceStore").isMember}handleAddVersionTag(e){if(!this.isWorkspaceMember())return pm.mediator.trigger("openUnjoinedWorkspaceModal");h.default.addEventV2({category:"collection",action:"initiate_version_tag_create",label:"collection_changelog",entityId:this.props.collectionUid}),this.setState({openVersionTagModal:!this.state.openVersionTagModal,revisionId:e})}handleRemoveVersionTag(e,t){if(!this.isWorkspaceMember())return pm.mediator.trigger("openUnjoinedWorkspaceModal");this.setState({isRemovingTag:!this.state.isRemovingTag});let s={collectionUid:this.props.collectionUid,tagId:t,revisionId:e};h.default.addEventV2({category:"collection",action:"version_tag_delete",label:"collection_changelog",entityId:this.props.collectionUid}),this.store.removeVersionTag(s).then((()=>{this.setState({isRemovingTag:!this.state.isRemovingTag})})).catch((()=>{this.setState({isRemovingTag:!this.state.isRemovingTag})}))}handleVersionTagModalClose(){this.setState({openVersionTagModal:!this.state.openVersionTagModal})}handleRestore(e,t){let s={collectionUid:this.props.collectionUid,maxId:e};this.restoreDate=a.a.getFormattedDateAndTime(t),h.default.addEventV2({category:"collection",action:"restore_collection",label:"collection_changelog",entityId:this.props.collectionUid}),this.setState({isRestored:!1}),this.setState({collectionRestoreTarget:s},(()=>{pm.syncManager.restoreCollection(s,((e,t)=>{e||t&&t.error?(this.setState({isRestored:!1,collectionRestoreTarget:null}),pm.toasts.error("We couldn't restore collection to a previous state. Please try again later.",{noIcon:!0,title:"Unable to restore collection"})):t&&t.data&&(this.setState({isRestored:!0,collectionRestoreTarget:null}),pm.toasts.success(`Your collection has been successfully restored to ${this.restoreDate||"a previous state"}.`,{noIcon:!0,title:"Collection restored"}))}))}))}subscribeToCollectionRestore(){this.unsubscribe=pm.eventBus.channel("sync-manager-internal").subscribe((e=>{if(!e)return;const t=Object(p.getEventNamespace)(e),s=Object(p.getEventName)(e),i=Object(p.getEventData)(e)||{};"collectionRestored"===s&&"command"===t&&(this.setState({isRestored:!0,collectionRestoreTarget:null}),i.error?pm.toasts.error("We couldn't restore collection to a previous state. Please try again later.",{noIcon:!0,title:"Unable to restore collection"}):pm.toasts.success(`Your collection has been successfully restored to ${this.restoreDate||"a previous state"}.`,{noIcon:!0,title:"Collection restored"}))}))}handleRetry(e){e.initialRetry?this.initializeFeeds():e.loadMoreRetry&&this.handleLoadMore()}getClasses(){return u()({"collection-browser-activity-feed-lists":!0},this.props.className)}render(){return n.a.createElement("div",{className:this.getClasses(),onClickCapture:e=>{console.log("|| clicked",e.target)}},n.a.createElement(l.default,{activityFeed:this.store,title:this.props.title,canAddVersionTag:this.props.canAddVersionTag,collectionRestoreTarget:this.state.collectionRestoreTarget,enableRestore:this.props.enableRestore,isLoggedIn:this.props.isLoggedIn,isRemovingTag:this.state.isRemovingTag,isRestored:this.state.isRestored,isVisible:this.props.isVisible,isOffline:this.props.isOffline,onLoadNew:this.handleLoadNew,onLoadMore:this.handleLoadMore,onSignIn:this.handleSignIn,onRestore:this.handleRestore,onRetry:this.handleRetry,onAddVersionTag:this.handleAddVersionTag,onRemoveVersionTag:this.handleRemoveVersionTag,onClose:this.props.onClose}),this.state.openVersionTagModal&&n.a.createElement(c.default,{activityFeed:this.store,revisionId:this.state.revisionId,collectionUid:this.props.collectionUid,isOffline:this.props.isOffline,isOpen:this.state.openVersionTagModal,onRequestClose:this.handleVersionTagModalClose}))}}},24817:function(e,t,s){"use strict";s.r(t),function(e){s.d(t,"default",(function(){return I}));var i,n=s(2),o=s.n(n),a=s(24818),l=s(7113),r=s.n(l),c=(s(7308),s(2756)),d=s.n(c),h=s(7762),p=s(2776),m=s(7326),g=s(7124),u=s(2825),y=s.n(u),v=s(2353),f=s(9),b=s(24819);let I=Object(v.observer)(i=class extends o.a.Component{constructor(t){super(t),this.handleScroll=this.handleScroll.bind(this),this.handleScrollDebounced=e.debounce(this.handleScroll,100),this.handleSignIn=this.handleSignIn.bind(this),this.handleRefreshFeed=this.handleRefreshFeed.bind(this),this.handleChangeLogLearn=this.handleChangeLogLearn.bind(this)}UNSAFE_componentWillReceiveProps(e){e.activityFeed&&this.props.activityFeed&&e.activityFeed.collectionUid&&e.activityFeed.collectionUid!==this.props.activityFeed.collectionUid&&this.refs.activity_feed&&(this.refs.activity_feed.scrollTop=0),e.isRestored&&e.isRestored!==this.props.isRestored&&this.handleRefreshFeed()}componentDidUpdate(t){const s=e.get(t,"activityFeed.feeds",[]),i=e.get(t,"activityFeed.meta",{}),n=e.filter(s,(t=>!("collection"===i.model&&e.includes(["subscribe","unsubscribe"],t.action)))),o=t.isOffline;o&&o!==this.props.isOffline&&e.isEmpty(n)&&this.props.onRetry({initialRetry:!0})}handleChangeLogLearn(){Object(p.openExternalLink)(h.ACTIVITY_FEED_AND_RESTORING_COLLECTION)}getRefreshTextClass(){return y()({"changelog-learn-more-header__refresh-container":!0,"is-loading-new":this.props.activityFeed.isLoadingNew})}handleSignIn(){this.props.onSignIn&&this.props.onSignIn()}handleScroll(){let t=this.refs.activity_feed;t.scrollHeight-(t.scrollTop+t.offsetHeight)<=5&&e.isEmpty(this.props.activityFeed.error)&&this.props.onLoadMore&&this.props.onLoadMore()}handleRefreshFeed(){this.props.onLoadNew&&this.props.onLoadNew().then((e=>{e&&(this.refs.activity_feed.scrollTop=0)}))}getClasses(){return y()({"activity-feed-container":!0},this.props.className)}render(){let t=this.props,s=e.get(t,"activityFeed.feeds",[]),i=e.get(t,"activityFeed.meta",{}),n=e.get(t,"activityFeed.error",{}),l=n&&"initial"===n.type,c=n&&"loadMore"===n.type,d=e.filter(s,(t=>!("collection"===i.model&&e.includes(["subscribe","unsubscribe"],t.action)))),h=e.isEmpty(d)?[]:r.a.getDateGroups(d,"createdAt","MMMM D, YYYY"),p=e.maxBy(d,"id");return o.a.createElement("div",{className:this.getClasses()},o.a.createElement(m.ContextBarViewHeader,{title:"Changelog",onClose:this.props.onClose},o.a.createElement(g.Button,{type:"tertiary",className:this.getRefreshTextClass(),onClick:this.handleRefreshFeed,disabled:t.activityFeed.isLoading||t.isOffline,tooltip:t.isOffline?"You can perform this action once you're back online":"Fetch newer feeds"},o.a.createElement(f.Icon,{name:"icon-action-refresh-stroke",className:"changelog-learn-more-header__refresh-icon pm-icon pm-icon-normal"}))),t.isOffline&&e.isEmpty(n)&&e.isEmpty(h)&&o.a.createElement(b.EmptyState,{illustration:o.a.createElement(f.IllustrationCheckInternetConnection,null),title:"Check your connection",message:"Get online to view Changelog"}),o.a.createElement("div",{className:"activity-feed",ref:"activity_feed",onScroll:this.handleScrollDebounced},(t.activityFeed.isLoading||l)&&o.a.createElement(a.LoadFeed,{error:n,key:"loading",isLoading:t.activityFeed.isLoading,onRetry:this.props.onRetry}),e.map(h,(t=>!e.isEmpty(t)&&o.a.createElement("div",{className:"activity-feed-date-group-wrapper",key:t.name},o.a.createElement("div",{className:"activity-feed-date-group"}," ",t.name," "),e.map(t.items,(t=>o.a.createElement(a.Activity,{activity:t,canAddVersionTag:this.props.canAddVersionTag,enableRestore:!(!this.props.enableRestore||!p||p.id===t.id),isRestoring:e.get(this.props,"collectionRestoreTarget.maxId")===t.id,isRemovingTag:this.props.isRemovingTag,isVisible:this.props.isVisible,isOffline:this.props.isOffline,key:t.id,meta:i,onAddVersionTag:this.props.onAddVersionTag,onRemoveVersionTag:this.props.onRemoveVersionTag,onRestore:this.props.onRestore})))))),!t.activityFeed.isLoading&&e.isEmpty(h)&&!n&&o.a.createElement("div",{className:t.className},o.a.createElement("div",{className:"activity-feed-loading-container "},"No activities yet"))),(t.activityFeed.isLoadingMore||c)&&o.a.createElement(a.LoadFeed,{error:n,key:"loading-more",isLoading:t.activityFeed.isLoadingMore,isOffline:t.isOffline,onRetry:this.props.onRetry}))}})||i;I.propTypes={activityFeed:d.a.object.isRequired,activityName:d.a.string,className:d.a.string,onLoadMore:d.a.func.isRequired}}.call(this,s(2753))},24825:function(e,t,s){"use strict";s.r(t),function(e){s.d(t,"default",(function(){return b}));var i,n=s(2),o=s.n(n),a=s(2353),l=s(2825),r=s.n(l),c=s(2776),d=s(7121),h=s(7124),p=s(8752),m=s(7307),g=s(11119),u=s(12863),y=s(2778),v=s(7762);s(6879);const f=[{model:"collection",type:"documentation",name:"Documentation"},{model:"collection",type:"testsuite",name:"Test Suite"},{model:"collection",type:"integrationtest",name:"Integration Test"},{model:"collection",type:"contracttest",name:"Contract Test"}];let b=Object(a.observer)(i=class extends n.Component{constructor(e){super(e),this.state={items:null,selectedAPI:null,selectedAPIVersion:null,selectedAPIContext:"",isAPIVersionSelectEnable:!1,isRequiredWarning:!0,isModalLoading:!1,isLoading:!1,isOnlyOneAPI:!1,modalOpenError:null},this.handleClose=this.handleClose.bind(this),this.handleAPISelect=this.handleAPISelect.bind(this),this.handleAPIVersionSelect=this.handleAPIVersionSelect.bind(this),this.handleAPIContextSelect=this.handleAPIContextSelect.bind(this),this.handleAddVersionTag=this.handleAddVersionTag.bind(this),this.handleActivityFeedTagsLearn=this.handleActivityFeedTagsLearn.bind(this)}componentDidMount(){let t=e.assign({},{collectionUid:this.props.collectionUid});this.store=this.props.activityFeed,this.initialFetch(t)}getCustomStyles(){return{margin:"auto",height:"384px",width:"350px"}}handleActivityFeedTagsLearn(){Object(c.openExternalLink)(v.ACTIVITY_FEED_VERSION_TAGS)}handleClose(){this.props.onRequestClose&&this.props.onRequestClose()}initialFetch(t){this.setState({isModalLoading:!0}),u.default.fetchPossibleAPIVersions(t).then((t=>{this.setState({isModalLoading:!1,items:t},(()=>{1===this.state.items.length&&this.setState({selectedAPI:e.head(this.state.items),isAPIVersionSelectEnable:!0,isOnlyOneAPI:!0})}))})).catch((e=>{this.setState({isModalLoading:!1,modalOpenError:e}),pm.logger.warn(e)}))}handleAPISelect(t){this.setState({isAPIVersionSelectEnable:!0});let s=e.find(this.state.items,["id",t]);e.isUndefined(s)?this.setState({selectedAPI:e.head(this.state.items)}):this.setState({selectedAPI:s})}handleAPIVersionSelect(t){let s=e.find(this.state.selectedAPI.versions,["id",t]);this.setState({selectedAPIVersion:s,isRequiredWarning:!this.state.selectedAPI||!this.state.selectedAPIContext})}handleAPIContextSelect(t){let s=e.find(f,["type",t]);this.setState({selectedAPIContext:s,isRequiredWarning:!this.state.selectedAPI||!this.state.selectedAPIVersion})}handleAddVersionTag(){if(this.state.selectedAPI&&this.state.selectedAPIVersion&&this.state.selectedAPIContext){this.setState({isLoading:!0});let e={collectionUid:this.props.collectionUid,revisionId:this.props.revisionId,apiVersionId:this.state.selectedAPIVersion.id,relationType:this.state.selectedAPIContext.type};this.store.addVersionTag(e).then((()=>{this.setState({isLoading:!1}),y.default.addEventV2({category:"collection",action:"successful_version_tag_create",label:"collection_changelog",entityId:this.props.collectionUid}),this.handleClose()})).catch((()=>{this.setState({isLoading:!1})}))}}getModalContentClasses(){return r()({"version-tag__modal-content":!0,"is-modal-loading":this.state.isModalLoading})}getDropdownHeadLabelClasses(e){return r()({"dropdown-head-label":!0,"placeholder-text":e})}renderModalContent(){return this.state.isModalLoading?o.a.createElement(d.default,null):this.state.modalOpenError?o.a.createElement("div",{className:"version-tag-modal-error"},o.a.createElement(g.default,{title:"Something went wrong",description:"There was a problem adding a version tag to this collection. Please try again after some time."})):o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:"version-tag__modal-content-heading"},"Link this collection revision to a specific API version.",o.a.createElement("span",{className:"btn btn-text version-tag__learn-btn-text",onClick:this.handleActivityFeedTagsLearn},"Learn More")),o.a.createElement("div",{className:"version-tag__modal-content-dropdown"},o.a.createElement("div",{className:"api-select__dropdown"},o.a.createElement("div",{className:"dropdown-label"},"Select API"),o.a.createElement(m.Dropdown,{onSelect:this.handleAPISelect},o.a.createElement(m.DropdownButton,{type:"secondary",size:"small"},o.a.createElement(h.Button,{className:"dropdown-head",disabled:this.state.isOnlyOneAPI},o.a.createElement("span",{className:this.getDropdownHeadLabelClasses(!this.state.selectedAPI)},this.state.selectedAPI&&this.state.selectedAPI.name||"Select an API"))),o.a.createElement(m.DropdownMenu,{className:"dropdown-menu",fluid:!0},e.isEmpty(this.state.items)?o.a.createElement(m.MenuItem,{disabled:!0},o.a.createElement("span",null,"There are no APIs in this workspace")):this.state.items.map((e=>o.a.createElement(m.MenuItem,{key:e.id,refKey:e.id},o.a.createElement("span",null,e.name))))))),o.a.createElement("div",{className:"api-version-select__dropdown"},o.a.createElement("div",{className:"dropdown-label"},"Select version"),o.a.createElement(m.Dropdown,{onSelect:this.handleAPIVersionSelect},o.a.createElement(m.DropdownButton,{type:"secondary",size:"small"},o.a.createElement(h.Button,{className:"dropdown-head",disabled:!this.state.isAPIVersionSelectEnable},o.a.createElement("span",{className:this.getDropdownHeadLabelClasses(!this.state.selectedAPIVersion)},this.state.selectedAPIVersion&&this.state.selectedAPIVersion.name||"Select a version"))),o.a.createElement(m.DropdownMenu,{className:"dropdown-menu-list",fluid:!0},this.state.selectedAPI&&!e.isEmpty(this.state.selectedAPI.versions)?this.state.selectedAPI.versions.map((e=>o.a.createElement(m.MenuItem,{key:e.id,refKey:e.id},o.a.createElement("span",null,e.name)))):o.a.createElement(m.MenuItem,{disabled:!0},o.a.createElement("span",null,"There are no API versions to tag this collection."))))),o.a.createElement("div",{className:"api-relation-select__dropdown"},o.a.createElement("div",{className:"dropdown-label"},"Add to API as"),o.a.createElement(m.Dropdown,{onSelect:this.handleAPIContextSelect},o.a.createElement(m.DropdownButton,{type:"secondary",size:"small"},o.a.createElement(h.Button,{className:"dropdown-head",disabled:!this.state.isAPIVersionSelectEnable},o.a.createElement("span",{className:this.getDropdownHeadLabelClasses(!this.state.selectedAPIContext)},this.state.selectedAPIContext.name||"Add this to your API as"))),o.a.createElement(m.DropdownMenu,{className:"dropdown-menu-list",fluid:!0},f.map((e=>o.a.createElement(m.MenuItem,{key:e.type,refKey:e.type},o.a.createElement("span",null,e.name)))))))),o.a.createElement("div",{className:"version-tag__modal-content-action"},o.a.createElement(h.Button,{type:"secondary",onClick:this.props.onRequestClose,className:"modal-cancel-btn"},"Cancel"),o.a.createElement(h.Button,{type:"primary",onClick:this.handleAddVersionTag,className:"modal-version-tag-btn",disabled:this.state.isRequiredWarning||this.state.isLoading||this.props.isOffline,tooltip:this.props.isOffline?"You can perform this action once you're back online":"To add a version tag, select an API version and what you want to add the collection as."},this.state.isLoading?o.a.createElement(d.default,null):"Add Version Tag")))}render(){return o.a.createElement(p.Modal,{className:"version-tag-modal",isOpen:this.props.isOpen,onRequestClose:this.props.onRequestClose,customStyles:this.getCustomStyles()},o.a.createElement(p.ModalHeader,null," Add a version tag "),o.a.createElement(p.ModalContent,{className:this.getModalContentClasses()},this.renderModalContent()))}})||i}.call(this,s(2753))}}]);