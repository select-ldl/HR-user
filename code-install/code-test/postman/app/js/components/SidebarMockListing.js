(window.webpackJsonp=window.webpackJsonp||[]).push([[64],{"./mocks/components/SidebarMockListItem.js":function(e,t,s){"use strict";s.r(t),function(e){s.d(t,"default",(function(){return v}));var i,o=s("../../node_modules/react/index.js"),n=s.n(o),r=s("./node_modules/classnames/index.js"),a=s.n(r),c=s("../../node_modules/@postman/aether/esmLib/index.js"),d=s("../../node_modules/mobx-react/dist/mobx-react.module.js"),l=s("./js/utils/ClipboardHelper.js"),m=s("./js/stores/get-store.js"),h=s("./js/components/base/Buttons.js"),u=s("./js/components/base/Dropdowns.js"),p=s("./js/containers/apps/requester/sidebar/SidebarListItem.js"),g=s("./mocks/components/MockActionItemWrapper.js"),k=s("./mocks/constants/MockErrors.js"),S=s("./mocks/constants/Permissions.js"),b=s("./mocks/services/FetchPermissionService.js"),I=s("./js/modules/services/ManageRolesModalService.js"),E=s("./mocks/components/InactiveMockIndicator.js"),f=s("./js/modules/services/ShareModalService.js"),R=s("./js/controllers/ShortcutsList.js"),_=s("./js/modules/services/AnalyticsService.js"),j=s("./runtime-repl/_common/WorkspaceHelpers.js");let v=Object(d.observer)(i=class extends o.Component{constructor(e){super(e),this.containerRef=this.containerRef.bind(this),this.handleEditName=this.handleEditName.bind(this),this.handleCopyUrl=this.handleCopyUrl.bind(this),this.handleDelete=this.handleDelete.bind(this),this.getMenuItems=this.getMenuItems.bind(this),this.getRightAlignedContainer=this.getRightAlignedContainer.bind(this),this.getActions=this.getActions.bind(this),this.getStatusIndicators=this.getStatusIndicators.bind(this),this.handleDropdownActionSelect=this.handleDropdownActionSelect.bind(this),this.handleRenameSubmit=this.handleRenameSubmit.bind(this),this.handleManageRoles=this.handleManageRoles.bind(this)}handleManageRoles(){_.default.addEventV2({category:"mock",action:"initiate_manage_roles",label:"sidebar",entityId:e.get(this.props,"mock.id")}),Object(I.manageRolesOnMock)(e.get(this.props,"mock.id"),{origin:"sidebar_mock_listing"})}handleDropdownActionSelect(t){if(!Object(m.getStore)("CurrentUserStore").isLoggedIn)return pm.mediator.trigger("showSignInModal",{type:"mock",subtitle:k.NOT_SIGNED_IN_ERROR,origin:"sidebar_mock_listing"});switch(t){case"delete":return void this.handleDelete();case"rename":return void this.handleEditName({origin:"sidebar"});case"manage-roles":return void this.handleManageRoles();case"move":return _.default.addEventV2({category:"mock",action:"initiate_move",label:"sidebar",entityId:e.get(this.props,"mock.id")}),void Object(f.moveMock)(e.get(this.props,"mock.id"),e.get(this.props,"mock.name"),{origin:"mock_sidebar"})}}containerRef(e){this.listItem=e}getMenuItemIconClasses(e){return a()({"dropdown-menu-item-icon":!0},"menu-icon--"+e)}getStatusIndicators(){const t=e.get(this.props,"mock.id"),s=this.props.permissions||{},i=Object(b.hasPermission)(s,t,S.DELETE_MOCK);return!(Object(b.hasPermission)(s,t,S.EDIT_MOCK)&&i)&&n.a.createElement(c.Icon,{name:"icon-state-locked-stroke",color:"content-color-tertiary",className:"mock-status-icon",size:"small",title:"只读"})}handleDelete(){pm.mediator.trigger("showDeleteMockModal",this.props.mock,null,{origin:"sidebar"})}getMockUrl(){return e.get(this.props,"mock.url","")}handleCopyUrl(){l.default.copy(this.getMockUrl()),pm.toasts.success("模拟 URL 已拷贝"),_.default.addEventV2({category:"mock",action:"copy_url",label:"sidebar",entityId:e.get(this.props,"mock.id")})}getActions(){const t=Object(m.getStore)("CurrentUserStore"),s=Object(j.canRequestAccess)(),i=e.get(this.props,"mock.id"),o=this.props.permissions||{},n=Object(m.getStore)("SyncStatusStore").isSocketConnected,r=n&&(!t.isLoggedIn||Object(b.hasPermission)(o,i,S.DELETE_MOCK)),a=n&&e.get(this.props,"mock.active")&&(!t.isLoggedIn||Object(b.hasPermission)(o,i,S.EDIT_MOCK)),c=n&&e.get(this.props,"mock.active")&&(!t.isLoggedIn||!!t.team)&&s,d=n&&Object(m.getStore)("FeatureFlagsStore").isEnabled("moveMocks")&&e.get(this.props,"mock.active")&&(!t.isLoggedIn||Object(b.hasPermission)(o,i,S.MOVE_MOCK));let l=[{type:"rename",label:"重命名",isEnabled:a,xpathLabel:"rename",shortcut:"rename"},{type:"manage-roles",label:"管理角色",isEnabled:c,xpathLabel:"manageRoles"}];return Object(m.getStore)("FeatureFlagsStore").isEnabled("moveMocks")&&l.push({type:"move",label:"移动",isEnabled:d,xpathLabel:"moveMock"}),l.push({type:"delete",label:"删除",isEnabled:r,xpathLabel:"delete",shortcut:"delete"}),l}getDisabledText(t,s){if(t){const t=k.PERMISSION_ERROR,i=k.NO_TEAM;if(!e.get(this.props,"mock.active")){if("delete"!==s)return k.INACTIVE_MOCK;if(!(!Object(m.getStore)("CurrentUserStore").isLoggedIn||Object(b.hasPermission)(e.get(this.props,"mockStore.permissions",{}),e.get(this.props,"mock.id"),S.DELETE_MOCK)))return t}if(!Object(m.getStore)("SyncStatusStore").isSocketConnected)return k.OFFLINE_ERROR;if("manage-roles"===s){const s=this.props.permissions||{},o=e.get(this.props,"mock.id");return Object(b.hasPermission)(s,o,S.UPDATE_MOCK_ROLES)&&!Object(m.getStore)("CurrentUserStore").team?i:t}return t}}handleEditName(t={}){this.setState({origin:t.origin},(()=>{_.default.addEventV2({category:"mock",action:"initiate_rename",label:t.origin,entityId:e.get(this.props,"mock.id")})})),e.invoke(this.listItem,"editText")}handleRenameSubmit(t){if(e.get(this.props,"mock.name")===t)return;const s={id:e.get(this.props,"mock.id"),name:t};this.props.onRename(s,this.state.origin),_.default.addEventV2({category:"mock",action:"submit_rename",label:this.state.origin,entityId:e.get(this.props,"mock.id")})}getRouteConfig(){return{routeIdentifier:"build.mock",routeParams:{mockId:e.get(this.props,"mock.id")}}}getOptions(){return{additionalContext:{origin:"sidebar"}}}getMenuItems(){return e.chain(this.getActions()).map((t=>n.a.createElement(u.MenuItem,{key:t.type,refKey:t.type,disabled:!t.isEnabled},n.a.createElement(g.default,{disabledText:!t.isEnabled&&this.getDisabledText(!t.isEnabled,t.type),mockId:e.get(this.props,"mock.id"),mockName:e.get(this.props,"mock.name",""),disabled:!t.isEnabled},n.a.createElement("span",{className:"mock-action-item"},n.a.createElement("div",{className:"dropdown-menu-item-label"},t.label),t.shortcut&&n.a.createElement("div",{className:"dropdown-menu-item-shortcut"},Object(R.getShortcutByName)(t.shortcut))))))).value()}getRightAlignedContainer(t,s){a()({"sidebar-mock-list-item__actions":!0,hovered:t});return t||s?n.a.createElement(n.a.Fragment,null,!e.get(this.props,"mock.active")&&n.a.createElement(E.default,null),n.a.createElement(h.Button,{className:"sidebar-action-btn",tooltip:"拷贝模拟 URL",type:"icon",onClick:this.handleCopyUrl},n.a.createElement(c.Icon,{name:"icon-action-copy-stroke",className:"pm-icon pm-icon-normal"}))):e.get(this.props,"mock.active")?null:n.a.createElement("div",{className:"inactive-mock-indicator__sidebar_fixed"},n.a.createElement(E.default,null))}getActionsMenuItems(){const e=this.getMenuItems();return n.a.createElement(u.DropdownMenu,{className:"mocks-dropdown-menu","align-right":!0},e)}render(){return n.a.createElement(p.default,{ref:this.containerRef,text:e.get(this.props,"mock.name",""),isSelected:this.props.isSelected,onClick:this.props.onResetFocusedItem,onRename:this.handleRenameSubmit,rightMetaComponent:this.getRightAlignedContainer,moreActions:this.getActionsMenuItems(),statusIndicators:this.getStatusIndicators,onActionsDropdownSelect:this.handleDropdownActionSelect,routeConfig:this.getRouteConfig(),options:this.getOptions()})}})||i}.call(this,s("./node_modules/lodash/lodash.js"))},"./mocks/components/SidebarMockListing.js":function(e,t,s){"use strict";s.r(t),function(e){s.d(t,"default",(function(){return O}));var i,o=s("../../node_modules/react/index.js"),n=s.n(o),r=s("../../node_modules/mobx-react/dist/mobx-react.module.js"),a=s("./node_modules/react-virtualized-auto-sizer/dist/index.esm.js"),c=s("./node_modules/react-window/dist/index.esm.js"),d=s("../../node_modules/mobx/lib/mobx.module.js"),l=s("../../node_modules/@postman/aether/esmLib/index.js"),m=s("./js/stores/get-store.js"),h=s("./mocks/components/SidebarMockListItem.js"),u=s("./js/components/base/Buttons.js"),p=s("./mocks/services/MockNavigationService.js"),g=s("./js/services/NavigationService.js"),k=s("./js/containers/apps/requester/sidebar/SidebarListActions.js"),S=s("./appsdk/sidebar/SidebarNoResultsFound/SidebarNoResultsFound.js"),b=s("./appsdk/sidebar/SidebarLoadingState/SidebarLoadingState.js"),I=s("./appsdk/sidebar/SidebarEmptyState/SidebarEmptyState.js"),E=s("./js/components/base/XPaths/XPath.js"),f=s("./mocks/constants/MockErrors.js"),R=s("./mocks/constants/Permissions.js"),_=s("./mocks/services/FetchPermissionService.js"),j=s("./mocks/components/MockOffline.js"),v=s("./js/components/base/keymaps/KeyMaps.js"),y=s("./collaboration/workspace/types/PermissionTypes.ts"),M=s("./collaboration/navigation/constants.js");let O=Object(r.observer)(i=class extends o.Component{constructor(t){super(t),this.store=Object(m.getStore)("RequesterSidebarStore"),this.listItemRefs={},this.handleCreate=this.handleCreate.bind(this),this.handleSearchChange=this.handleSearchChange.bind(this),this.handleRetry=this.handleRetry.bind(this),this.successHandler=this.successHandler.bind(this),this.handleRename=this.handleRename.bind(this),this.focusNext=this.focusNext.bind(this),this.focusPrev=this.focusPrev.bind(this),this.handleDeleteShortcut=this.handleDeleteShortcut.bind(this),this.handleRenameShortcut=this.handleRenameShortcut.bind(this),this.scrollToItemById=this.scrollToItemById.bind(this),this.resetFocusedItem=this.resetFocusedItem.bind(this),this.getListContainer=this.getListContainer.bind(this),this.getSidebarEmptyState=this.getSidebarEmptyState.bind(this),this.mockStore=e.get(this.props,"controller.mockListStore"),this.focusReactionDisposer=Object(d.reaction)((()=>this.mockStore.focusedItem||this.mockStore.activeItem),(e=>{e&&requestIdleCallback(this.scrollToItemById.bind(this,e),{timeout:5e3})}),{fireImmediately:!0})}componentWillUnmount(){this.focusReactionDisposer&&this.focusReactionDisposer()}resetFocusedItem(){this.mockStore.resetFocusedItem()}handleRetry(){this.mockStore.reload()}scrollToItemById(t){if(!t)return;const s=e.findIndex(e.get(this.mockStore,"filteredItems"),(e=>e.id===t));s<0||this.listRef&&this.listRef.scrollToItem(s)}successHandler(){this.mockStore.hydrate()}handleRename(e,t){this.mockStore.rename(e,{origin:t})}handleCreate(){p.default.transitionTo("build.mockCreate",{},{},{additionalContext:{origin:"sidebar"}})}handleSearchChange(e){this.mockStore.setSearchQuery(e)}componentDidMount(){pm.mediator.on("refreshSidebarMockListing",this.successHandler)}componentWillUnmount(){pm.mediator.off("refreshSidebarMockListing",this.successHandler)}createMock(){p.default.transitionTo("build.mockCreate",{},{},{additionalContext:{origin:"sidebar_empty_listing"}})}getFilteredMocks(){return this.mockStore.filteredItems}onClickRequestAccess(e,t){g.default.transitionTo(M.ACCESS_REQUEST_CREATE_BUILD_IDENTIFIER,null,{entityId:e,entityName:t,entityType:"mock",type:"grant_role"})}handleDeleteShortcut(){const t=e.get(this.mockStore,"permissions",{}),s=this.mockStore.filteredItems[this.mockStore.focusedItemIndex]||this.mockStore.filteredItems[this.mockStore.activeItemIndex],i=Object(_.hasPermission)(t,s.id,R.DELETE_MOCK);if(Object(m.getStore)("SyncStatusStore").isSocketConnected){if(!Object(m.getStore)("CurrentUserStore").isLoggedIn)return pm.mediator.trigger("showSignInModal",{type:"mock",subtitle:f.NOT_SIGNED_IN_ERROR,origin:"shortcut"});s&&i?pm.mediator.trigger("showDeleteMockModal",s,null,{origin:"shortcut"}):pm.toasts.error(f.PERMISSION_ERROR,{noIcon:!0,primaryAction:{label:"Request Access",onClick:()=>this.onClickRequestAccess(s.id,s.name)}})}else pm.toasts.error(f.OFFLINE_ERROR,{title:"你离线了"})}handleRenameShortcut(){const t=e.get(this.mockStore,"permissions",{}),s=this.mockStore.filteredItems[this.mockStore.focusedItemIndex]||this.mockStore.filteredItems[this.mockStore.activeItemIndex],i=Object(_.hasPermission)(t,s.id,R.EDIT_MOCK);if(Object(m.getStore)("SyncStatusStore").isSocketConnected){if(!Object(m.getStore)("CurrentUserStore").isLoggedIn)return pm.mediator.trigger("showSignInModal",{type:"mock",subtitle:f.NOT_SIGNED_IN_ERROR,origin:"shortcut"});e.get(s,"active")?s&&i?e.invoke(this.listItemRefs[s.id],"handleEditName",{origin:"shortcut"}):pm.toasts.error(f.PERMISSION_ERROR,{noIcon:!0,primaryAction:{label:"Request Access",onClick:()=>this.onClickRequestAccess(s.id,s.name)}}):pm.toasts.error(f.INACTIVE_MOCK)}else pm.toasts.error(f.OFFLINE_ERROR,{title:"你离线了"})}getKeyMapHandlers(){return{nextItem:pm.shortcuts.handle("nextItem",this.focusNext),prevItem:pm.shortcuts.handle("prevItem",this.focusPrev),delete:pm.shortcuts.handle("delete",this.handleDeleteShortcut),rename:pm.shortcuts.handle("rename",this.handleRenameShortcut)}}focusNext(e){e&&e.preventDefault(),this.mockStore.focusNext()}focusPrev(e){e&&e.preventDefault(),this.mockStore.focusPrev()}getListItem({index:t,style:s}){const i=this.getFilteredMocks()[t]||{},o=g.default.isActive("build.mock",{mockId:i.id})||g.default.isActive("build.mock",{mockId:i.id},{ctx:"info"})||g.default.isActive("build.mockEdit",{mockId:i.id}),r=e.get(this.mockStore,"permissions",{});return o?this.mockStore.setActiveItem(i.id):this.mockStore.activeItem===i.id&&this.mockStore.resetActiveItem(),n.a.createElement(E.default,{identifier:i.id},n.a.createElement("div",{style:s},n.a.createElement(h.default,{ref:e=>{this.listItemRefs[i.id]=e},key:i.id,mock:i,onRename:this.handleRename,isSelected:this.mockStore.focusedItem===i.id||o,permissions:r,onResetFocusedItem:this.resetFocusedItem})))}getTooltip(){const e=this.canAddMockToWorkspace();return Object(m.getStore)("SyncStatusStore").isSocketConnected?e?"创建模拟服务器":f.PERMISSION_ERROR:f.OFFLINE_ERROR}canAddMockToWorkspace(){const t=Object(m.getStore)("ActiveWorkspacePermissionStore"),s=t&&t.permissions;return!Object(m.getStore)("CurrentUserStore").isLoggedIn||e.get(s,y.WORKSPACE_PERMISSIONS.ADD_MOCK_TO_WORKSPACE,!0)}getSidebarEmptyState(){const e=this.canAddMockToWorkspace(),t=Object(m.getStore)("SyncStatusStore").isSocketConnected;return n.a.createElement(I.default,{illustration:n.a.createElement(l.IllustrationNoMockServer,null),title:"您没有任何模拟服务器.",message:"模拟服务器使您可以模拟集合中的端点及其对应的响应, 而无需实际设置后端.",action:{label:"创建模拟服务器",handler:this.createMock,tooltip:this.getTooltip()},hasPermissions:t&&e})}getListContainer(){const e=this.mockStore.values,t=this.getFilteredMocks(),s=this.mockStore.searchQuery;if(this.mockStore.isHydrating)return n.a.createElement(b.default,null);if(0===e.length&&!s)return this.getSidebarEmptyState();if(0===t.length)return n.a.createElement(S.default,{searchQuery:s,illustration:n.a.createElement(l.IllustrationSearch,null)});{const e=e=>n.a.createElement(r.Observer,null,this.getListItem.bind(this,e));return n.a.createElement(a.default,null,(({height:s,width:i})=>n.a.createElement(c.FixedSizeList,{height:s,width:i,itemCount:t.length,ref:e=>{this.listRef=e},itemSize:28,overscanCount:10},e)))}}render(){const e=this.mockStore.errorFetchingMocks,t=this.mockStore.searchQuery,s=this.mockStore.isOffline,i=Object(m.getStore)("SyncStatusStore").isSocketConnected;return s?n.a.createElement(j.default,{origin:"sidebar"}):e?n.a.createElement("div",{className:"sidebar-mock-listing__error__wrapper"},n.a.createElement("div",{className:"sidebar-mock-listing__error"},n.a.createElement(l.IllustrationInternalServerError,null),n.a.createElement("div",{className:"sidebar-mock-listing__error__content"},n.a.createElement("div",{className:"sidebar-mock-listing__error__content__header"},"出了些问题"),n.a.createElement("div",{className:"sidebar-mock-listing__error__content__sub-header"},"加载模拟服务器时发生意外错误. 请再试一次.")),n.a.createElement(u.Button,{className:"btn-small sidebar-mock-listing__error__retry-button",type:"primary",onClick:this.handleRetry},"再试一次"))):n.a.createElement("div",{className:"sidebar-mock-listing__container"},n.a.createElement(k.default,{createNewConfig:{tooltip:this.getTooltip(),disabled:!this.canAddMockToWorkspace()||!i,onCreate:this.handleCreate,xPathIdentifier:"addMock"},onSearch:this.handleSearchChange,searchQuery:t}),n.a.createElement(v.default,{handlers:this.getKeyMapHandlers()},n.a.createElement("div",{className:"sidebar-mock-listing__container__list"},n.a.createElement(E.default,{identifier:"mock"},this.getListContainer()))))}})||i}.call(this,s("./node_modules/lodash/lodash.js"))}}]);