(window.webpackJsonp=window.webpackJsonp||[]).push([[34],{"./api-dev/components/release/context-bar/ReleaseChangelogContextBarView/ReleaseChangelogContextBarView.js":function(e,t,o){"use strict";o.r(t),function(e){o.d(t,"default",(function(){return x}));var s,n=o("../../node_modules/react/index.js"),a=o.n(n),r=o("../../node_modules/mobx-react/dist/mobx-react.module.js"),i=o("../../node_modules/mobx/lib/mobx.module.js"),l=o("./appsdk/contextbar/ContextBarViewHeader.js"),h=o("./node_modules/classnames/index.js"),c=o.n(h),d=o("./api-dev/components/api-version/context-bar/api-version-changelog/APIVersionChangelogGroup/APIVersionChangelogGroup.js"),g=o("./js/components/base/LoadingIndicator.js"),p=o("./js/stores/get-store.js"),m=o("../../node_modules/@postman/aether/esmLib/index.js"),u=o("./js/components/base/Buttons.js"),f=o("./schema/components/ErrorChangelog.js"),C=o("./schema/components/OfflineChangelog.js"),b=o("./js/components/activity-feed/Activity.js");let x=Object(r.observer)(s=class extends n.Component{constructor(t){super(t),this.state={releaseGroup:{},isLoading:!0,loadingErr:!1},this.fetchChangelogs=this.fetchChangelogs.bind(this),this.handleScroll=this.handleScroll.bind(this),this.handleScrollDebounced=e.debounce(this.handleScroll,100),this.loadMoreChanges=this.loadMoreChanges.bind(this)}componentDidMount(){this.isReleaseChanging=Object(i.reaction)((()=>e.get(this.props,"contextData.model.activeRelease")),(()=>{this.fetchChangelogs()}),{fireImmediately:!0})}componentWillUnmount(){this.isReleaseChanging&&this.isReleaseChanging()}getRefreshTextClass(){return c()({"release-changelog-context-view-wrapper__refresh-button":!0,"release-changelog-context-view-wrapper__refresh-button__loading":this.state.isLoading})}getRefreshIconText(){return!Object(p.getStore)("SyncStatusStore").isSocketConnected?"联网以执行此操作":this.state.isLoading?"请稍等...":"刷新更新日志"}fetchChangelogs(){this.setState({releaseGroup:{},isLoading:!0,loadingErr:!1}),this.props.controller.fetchChangelog(e.get(this.props,"contextData.model",{})).then((e=>{this.setState({releaseGroup:e,isLoading:!1})})).catch((e=>{this.setState({isLoading:!1,loadingErr:!0})}))}handleScroll(){let t=this.refs.changelog_feed;if(t.scrollHeight-(t.scrollTop+t.offsetHeight)<=5){if(!e.isEmpty(e.get(this.props,"controller.loadMoreError"))||e.get(this.props,"controller.isLoaded")||!e.get(this.props,"controller.loadMore"))return;this.loadMoreChanges()}}loadMoreChanges(){return this.props.controller.loadMore().then((t=>{e.isEmpty(t)||this.setState({releaseGroup:t,isLoading:!1})}))}renderChangelog(){const t=!Object(p.getStore)("SyncStatusStore").isSocketConnected;if(t&&this.state.isLoading)return a.a.createElement(C.default,null);if(this.state.isLoading)return a.a.createElement(g.default,null);if(this.state.loadingErr)return a.a.createElement(f.default,{onRetry:this.fetchChangelogs});const o=e.get(this.props,"contextData.model",{}),s=e.get(this.props,"controller.isLoadingMore"),n=e.get(this.props,"controller.loadMoreError",{});return a.a.createElement(a.a.Fragment,null,a.a.createElement("div",{className:"release-changelog",ref:"changelog_feed",onScroll:this.handleScrollDebounced},a.a.createElement(d.default,{model:o,release:this.state.releaseGroup,promoteTab:e.get(this.props,"contextData.promoteTab"),isLastRelease:!0})),(s||!e.isEmpty(n))&&a.a.createElement(b.LoadFeed,{error:n,key:"loading-more",isLoading:s,isOffline:t,onRetry:this.loadMoreChanges}))}render(){return a.a.createElement("div",{className:"release-changelog-context-view-wrapper"},a.a.createElement(l.ContextBarViewHeader,{title:this.props.title,onClose:this.props.onClose},a.a.createElement(u.Button,{className:this.getRefreshTextClass(),tooltip:this.getRefreshIconText(),tooltipImmediate:!0,type:"tertiary",onClick:this.fetchChangelogs,disabled:this.state.isLoading||!Object(p.getStore)("SyncStatusStore").isSocketConnected},a.a.createElement(m.Icon,{name:"icon-action-refresh-stroke"}))),this.renderChangelog())}})||s}.call(this,o("./node_modules/lodash/lodash.js"))}}]);