(window.webpackJsonp=window.webpackJsonp||[]).push([[106],{"./search/components/context-bar/RelatedCollectionCBView.js":function(e,t,l){"use strict";l.r(t),function(e){l.d(t,"default",(function(){return N}));var o,s=l("../../node_modules/react/index.js"),a=l.n(s),i=l("./node_modules/uuid/v4.js"),n=l.n(i),c=l("../../node_modules/mobx/lib/mobx.module.js"),r=l("../../node_modules/mobx-react/dist/mobx-react.module.js"),d=l("./node_modules/classnames/index.js"),m=l.n(d),h=l("../../node_modules/@postman/aether/esmLib/index.js"),u=l("./js/components/base/Buttons.js"),p=l("./js/stores/get-store.js"),b=l("./search/services/SearchService.js"),_=l("./js/components/base/LoadingIndicator.js"),C=l("./search/utils/index.js"),E=l("./appsdk/components/link/Link.js"),g=l("./js/modules/services/AnalyticsService.js"),f=l("./runtime-repl/collection/_api/CollectionInterface.js"),v=l("./search/components/context-bar/RelatedCollectionListItem.js"),y=l("./search/constants.js"),k=l("./js/services/NavigationService.js");const x=l("../../node_modules/styled-components/dist/styled-components.browser.esm.js").default.p`
  font-size: ${e=>e.theme["text-size-m"]};
  line-height: 1.6;
  color: ${e=>e.theme["content-color-secondary"]};
  padding: 0px ${e=>e.theme["spacing-xl"]}
  `;let N=Object(r.observer)(o=class extends s.Component{constructor(t){super(t),this.handleCollectionFork=(e,t)=>{if(g.default.addEventV2AndPublish({category:"related",action:"fork",label:"collection-forked",value:t,entityType:"collection",entityId:e,traceId:this.traceId}),Object(p.getStore)("CurrentUserStore").isLoggedIn)return Object(f.collectionActions)(e,"fork",null,{origin:"request-contextbar"});pm.mediator.trigger("showSignInModal",{type:"fork",origin:"fork_collection_modal"})},this.state={isLoading:!0,relatedCollections:[],loadError:!1,loadEmpty:!1,hasMoreResults:!1,loadingMore:!1,requestUrl:"",currentOffset:0},this.traceId="",this.fetchRelatedCollections=e.debounce(this.fetchRelatedCollections.bind(this),1500),this.sanitizedCountPlaceholder=this.sanitizedCountPlaceholder.bind(this),this.getCollectionUrl=this.getCollectionUrl.bind(this),this.requestOrigin="contextBarRecommendation",this.handleCollectionFork=this.handleCollectionFork.bind(this),this.sanitizedCountPlaceholder=this.sanitizedCountPlaceholder.bind(this),this.hideForkInfo=!0,this.relatedCollectionsList=a.a.createRef(),this.handleScroll=e.debounce(this.handleScroll.bind(this),1e3)}componentDidMount(){const e=Object(p.getStore)("SearchStore").relatedCollectionsTraceId;this.traceId=e||n()();let{type:t,id:l}=this.props.contextData;g.default.addEventV2AndPublish({category:"related",action:"initiate",entityType:t,entityId:l,traceId:this.traceId}),this.disposePreviewReaction=Object(c.reaction)((()=>{let e=Object(p.getStore)("EditorStore").find(this.props.contextData.editorId),t=(e&&e.model).resourceToSave(),l=Object(p.getStore)("ActiveEnvironmentStore").id;return t.url+l}),(()=>{this.fetchRelatedCollections(this.props.contextData.editorId)})),this.fetchRelatedCollections(this.props.contextData.editorId)}componentWillUnmount(){this.disposePreviewReaction&&this.disposePreviewReaction(),e.invoke(this.relatedCollectionsList,"removeEventListener","scroll")}handleScroll(){this.relatedCollectionsList.scrollTop+this.relatedCollectionsList.clientHeight>=this.relatedCollectionsList.scrollHeight&&!this.state.loadingMore&&this.state.hasMoreResults&&this.loadMoreCollections()}loadMoreCollections(){this.setState({loadingMore:!0});const{requestUrl:t,currentOffset:l}=this.state;b.default.getRequestRelatedCollections(t,this.traceId,this.props.contextData.parentCollectionUid,this.requestOrigin,y.RELATED_COLLECTIONS_CB_COUNT,l).then((t=>{let o=e.get(t,"data",[]),s=this.state.relatedCollections;this.setState({relatedCollections:e.concat(s,o),hasMoreResults:t.meta.total>l+y.RELATED_COLLECTIONS_CB_COUNT,currentOffset:l+y.RELATED_COLLECTIONS_CB_COUNT,loadingMore:!1})})).catch((e=>{pm.logger.error("RelatedCollectionCBView~loadMoreCollections: Failed to fetch more related collections"),this.setState({loadingMore:!1})}))}sanitizedCountPlaceholder(t,l){return e.isUndefined(t)&&(t=0),`${t=C.default.convertToUserFriendlyMetric(t)} ${l}`}fetchRelatedCollections(t){this.props.controller.getResolvedRequest(t).then((e=>{if(e===this.state.requestUrl)throw new Error("sameRequest");return this.setState({isLoading:!0,loadError:!1,relatedCollections:[],requestUrl:e}),""===e||0===e.length?{}:b.default.getRequestRelatedCollections(e,this.traceId,this.props.contextData.parentCollectionUid,this.requestOrigin,y.RELATED_COLLECTIONS_CB_COUNT)})).then((t=>{let l=e.get(t,"data",[]);if(0===l.length)this.setState({relatedCollections:[],isLoading:!1});else{let{type:o,id:s}=this.props.contextData;g.default.addEventV2AndPublish({category:"related",action:"view",value:l.length,entityType:o,entityId:s,traceId:this.traceId}),this.setState({relatedCollections:l,isLoading:!1,currentOffset:y.RELATED_COLLECTIONS_CB_COUNT,hasMoreResults:t.meta.total>y.RELATED_COLLECTIONS_CB_COUNT},(()=>{e.isFunction(this.relatedCollectionsList.addEventListener)&&this.relatedCollectionsList.addEventListener("scroll",this.handleScroll)}))}})).catch((e=>{"sameRequest"===!e.message?(pm.logger.error("RelatedCollectionCBView~fetchRelatedCollections: Failed to fetch related collections"),this.setState({relatedCollections:[],isLoading:!1,loadError:!0})):this.setState({isLoading:!1})}))}getCollectionUrl(t){const{publisherHandle:l,workspaces:o}=t,s=e.get(o,"0.slug");return l&&s?`${window.postman_explore_url}/${l}/workspace/${s}/collection/${t.id}`:`${window.postman_explore_url}/v1/backend/redirect?type=${t.entityType}&id=${t.id}&publisherType=${t.publisherType}&publisherId=${t.publisherId}`}getCollectionList(e){if(0===e.length)return;let{type:t,id:l}=this.props.contextData;return a.a.createElement("div",{className:"related-collections-cb__list",ref:e=>this.relatedCollectionsList=e},e.map(((e,t)=>{const l=e.document,o=this.getCollectionUrl(l);return a.a.createElement(v.default,{key:t,collection:l,redirectUrl:o,sanitizedCountPlaceholder:this.sanitizedCountPlaceholder,hideForkInfo:this.hideForkInfo,traceId:this.traceId,contextData:this.props.contextData,handleCollectionFork:this.handleCollectionFork,index:t})})),this.state.loadingMore&&a.a.createElement("div",{className:"related-collections-cb__list-load-more"},a.a.createElement(_.default,null)),a.a.createElement("div",{className:"related-collections-cb__list-footer"},a.a.createElement("div",null,"探索更多集合在"),a.a.createElement("div",{type:"link-subtle"},a.a.createElement(E.default,{to:`${window.postman_explore_redirect_url}/collections`,className:"lead-link",onClick:()=>{g.default.addEventV2AndPublish({category:"related",action:"click",label:"explore",entityType:t,entityId:l,traceId:this.traceId})}},"公共API网络")),"."))}getErrorState(){let e=this.props.contextData.editorId;return a.a.createElement("div",{className:"related-collections-cb__error"},a.a.createElement(h.BlankState,{className:"related-collections-cb__error-state-component",title:"无法加载相关集合",description:"无法加载相关集合. 尝试重新加载.",primaryAction:a.a.createElement(h.Button,{type:"outline",text:"重新加载",onClick:()=>this.fetchRelatedCollections(e)})},a.a.createElement(h.IllustrationInternalServerError,null)))}getEmptyState(){return a.a.createElement("div",{className:"related-collections-cb__empty-state"},a.a.createElement(h.BlankState,{className:"related-collections-cb__empty-state-component",title:"没有相关的集合",description:a.a.createElement(x,null,"尝试不同的请求或探索集合在",a.a.createElement(h.Button,{type:"monochrome-plain",onClick:()=>{k.default.openURL(`${window.postman_explore_redirect_url}/collections`)},text:"公共API网络"}))},a.a.createElement(h.IllustrationNoCollection,null)))}render(){let{isLoading:e,relatedCollections:t,loadError:l}=this.state;return a.a.createElement("div",{className:"related-collections-cb"},a.a.createElement("div",{className:m()("right-context-bar-header",this.props.className)},a.a.createElement("span",{className:"right-context-bar__title"},this.props.title,a.a.createElement(h.Badge,{status:"info",text:"测试",className:"related-collections-cb-badge"})),a.a.createElement("div",{className:"right-context__actions-container"},this.props.children,a.a.createElement(u.Button,{className:"context-bar-actions__button",type:"tertiary",onClick:this.props.onClose},a.a.createElement(h.Icon,{name:"icon-action-close-stroke",className:"right-context-bar__close-icon"})))),e?a.a.createElement("div",{className:"related-collections-cb__loader"},a.a.createElement(_.default,{className:"related-collections-cb__loader-item"})):l?this.getErrorState():t.length>0?a.a.createElement("div",{className:"related-collections-cb__container"},a.a.createElement("div",{className:"related-collections-cb__subheading"},a.a.createElement(h.Text,{type:"body-medium",color:"content-color-secondary"},"发现最符合您要求的公共集合")),this.getCollectionList(t)):this.getEmptyState())}})||o}.call(this,l("./node_modules/lodash/lodash.js"))},"./search/components/context-bar/RelatedCollectionListItem.js":function(e,t,l){"use strict";l.r(t),function(e){l.d(t,"default",(function(){return d}));var o=l("../../node_modules/react/index.js"),s=l.n(o),a=l("../../node_modules/@postman/aether/esmLib/index.js"),i=l("./appsdk/components/link/Link.js"),n=l("./js/modules/services/AnalyticsService.js"),c=l("./version-control/components.js"),r=l("./js/stores/get-store.js");function d(t){const{collection:{id:l,name:o,publisherName:d,workspaces:m,views:h,forkLabel:u},redirectUrl:p,index:b}=t;return s.a.createElement("div",{className:"related-collections-cb__list-item"},s.a.createElement("div",{className:"related-collections-cb__list-item-details"},s.a.createElement("div",{className:"related-collections-cb__list-item-profile-icon"}),s.a.createElement("div",{className:"related-collections-cb__list-item-info"},s.a.createElement("div",{className:"related-collections-cb__list-item-title-wrapper"},s.a.createElement(a.Text,{color:"content-color-primary"},s.a.createElement(a.Text,{type:"link-subtle",className:"related-collections-cb__list-item-title"},s.a.createElement(i.default,{to:p,onClick:e=>{n.default.addEventV2AndPublish({category:"related",action:"view-collection",value:b,label:"public-collection",entityType:"collection",entityId:l,traceId:t.traceId})}},o)))),s.a.createElement("div",{className:"related-collections-cb__list-item-meta"},s.a.createElement("div",{className:"related-collections-cb__list-item-meta-row"},u&&s.a.createElement("div",{className:"related-collections-cb__list-item-fork-label"},s.a.createElement(a.Icon,{name:"icon-action-fork-stroke-small",color:"content-color-secondary",size:"small",className:"related-collections-cb__list-item-fork-label-icon"}),s.a.createElement("div",{className:"related-collections-cb__list-item-fork-label-text"},u))),s.a.createElement("div",{className:"related-collections-cb__list-item-meta-row"},s.a.createElement(a.Text,{type:"body-medium",color:"content-color-secondary"},d)),s.a.createElement("div",{className:"related-collections-cb__list-item-meta-row"},s.a.createElement(a.Icon,{name:"icon-action-view-stroke-small",color:"content-color-tertiary",size:"small",className:"related-collections-cb__list-item-meta-row-icon"}),s.a.createElement(a.Text,{type:"body-medium",color:"content-color-secondary"},t.sanitizedCountPlaceholder(h,"views")))))),s.a.createElement("div",{className:"related-collections-cb__list-item-fork-button"},s.a.createElement(c.ForkButton,{modelId:l,model:"collection",origin:"request-contextbar",disabled:!Object(r.getStore)("SyncStatusStore").isSocketConnected,disabledTooltip:"在线创建分叉或查看现有分叉.",className:"related-collections-cb__list-item-fork-button",onFork:()=>t.handleCollectionFork(l,b),workspaceId:e.get(m,"0.id")})))}}.call(this,l("./node_modules/lodash/lodash.js"))}}]);