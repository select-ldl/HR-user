(window.webpackJsonp=window.webpackJsonp||[]).push([[52],{"./monitors/containers/MonitorActivityInfo.js":function(t,e,o){"use strict";o.r(e),function(t){o.d(e,"default",(function(){return g}));var n,i=o("../../node_modules/react/index.js"),s=o.n(i),a=o("../../node_modules/@postman/aether/esmLib/index.js"),r=o("../../node_modules/mobx-react/dist/mobx-react.module.js"),c=o("../../node_modules/mobx/lib/mobx.module.js"),l=o("./node_modules/moment/moment.js"),m=o.n(l),d=o("./js/components/base/Buttons.js"),_=o("./monitors/components/common/UserInfo.js"),p=o("./appsdk/components/link/Link.js"),f=o("./appsdk/contextbar/ContextBarViewHeader.js"),h=o("./js/stores/get-store.js"),v=o("./monitors/stores/domain/MonitorPermissionStore.js"),u=o("./js/utils/ClipboardHelper.js"),y=o("./monitors/components/common/MonitorOfflineContextBar.js"),E=o("./integrations/components/context-bar/IntegrationContextBarList.js"),w=o("./js/containers/new-button/services/VersionTagService.js"),I=o("./monitors/utils/messages/index.js"),b=o("./runtime-repl/collection/_api/CollectionStoreV2.js"),x=o("./runtime-repl/environment/_api/EnvironmentStoreV2.js"),N=o("./monitors/components/common/MonitorDependencyListItem.js");function T(){return T=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var o=arguments[e];for(var n in o)Object.prototype.hasOwnProperty.call(o,n)&&(t[n]=o[n])}return t},T.apply(this,arguments)}let g=Object(r.observer)(n=class extends i.Component{constructor(e){super(e),this.loadCollectionInfo=async()=>{let e;try{e=await Object(b.subscribeOne)(this.props.controller.store.data.collection)}catch(e){pm.logger.warn(I.COLLECTION_FETCH_ERROR.warn,e),pm.toasts.error(t.get(e,"message")||I.COLLECTION_FETCH_ERROR.error)}finally{this.setState({collectionInfo:e,collectionLoading:!1})}},this.loadEnvironmentInfo=async()=>{let t;try{let e=this.props.controller.store.data.environment;e&&(t=await Object(x.subscribeOne)(e))}catch(t){}finally{this.setState({environment:t,environmentLoading:!1})}},this.loadVersionInfo=async()=>{let e;const o=this.props.controller.store.data.versionTag;try{const n=await this.loadOwnVersions({collectionUid:this.props.controller.store.data.collection});let i=t.find(n,["id",o]);e=i?i.name:"当前"}catch(e){pm.logger.warn(I.VERSION_TAGS_ERROR.warn,e),pm.toasts.error(t.get(e,"message")||I.VERSION_TAGS_ERROR.error)}finally{this.setState({versionName:e})}},this.monitorPermissionStore=new v.default,this.showPrvtUserTooltip=this.showPrvtUserTooltip.bind(this),this.hidePrvtUserTooltip=this.hidePrvtUserTooltip.bind(this),this.state={showPrvtUserTooltip:!1,idCopySuccess:!1,forkedFromCollectionId:null,forkName:null,versionTag:null,versionName:"",environment:null,collectionLoading:!0,environmentLoading:!0},this.loadOwnVersions=this.loadOwnVersions.bind(this)}componentDidMount(){Object(c.when)((()=>this.props.controller.store.data.collection),(()=>this.loadMonitorInfo()))}async loadMonitorInfo(){this.setState({collectionLoading:!0,environmentLoading:!0}),await Object(h.getStore)("SyncStatusStore").onSyncAvailable(),await Promise.allSettled([this.loadCollectionInfo(),this.loadVersionInfo(),this.loadEnvironmentInfo()])}loadOwnVersions(t){return Object(w.fetchAllTags)(t).then((t=>t))}componentWillUnmount(){clearTimeout(this.clearIdCopySuccessTimeout),t.invoke(this.state,"collectionInfo.unsubscribe"),t.invoke(this.state,"environment.unsubscribe")}showPrvtUserTooltip(){this.setState({showPrvtUserTooltip:!0})}hidePrvtUserTooltip(){this.setState({showPrvtUserTooltip:!1})}fetchUserName(e,o){let n=o.reduce(((t,e)=>(t[e.id]=e,t)),{});return t.get(n,e,{}).name}canViewCreatorInfo(){return this.monitorPermissionStore.can("viewCreatorInfo",this.props.contextData.id)}copyMonitorId(t){this.state.idCopySuccess||(u.default.copy(t),this.setState({idCopySuccess:!0},(()=>{this.clearIdCopySuccessTimeout=setTimeout((()=>this.setState({idCopySuccess:!1})),3e3)})))}fetchCopyIcon(t){return t?s.a.createElement(a.Icon,{name:"icon-state-success-stroke",className:"monitor-info-context-view__entity__content__toggle__success"}):s.a.createElement(a.Icon,{name:"icon-action-copy-stroke",className:"monitor-info-context-view__entity__content__toggle__copy"})}render(){const{isOffline:e}=this.props.controller.monitorActivityDetailsStore;this.monitorInfo=t.get(this.props,"contextData",{});const o=m()(this.monitorInfo.createdAt).format("DD MMM YYYY, h:mm A");return s.a.createElement("div",{className:"monitor-info-context-view-wrapper"},s.a.createElement(f.ContextBarViewHeader,{title:this.props.title,onClose:this.props.onClose}),e&&"number"==typeof this.props.contextData.createdBy?s.a.createElement(y.default,null):s.a.createElement("div",{className:"monitor-info-context-view"},s.a.createElement("div",{className:"monitor-info-context-view__entity"},s.a.createElement("div",{className:"monitor-info-context-view__entity__label"},"ID"),s.a.createElement("div",{className:"monitor-info-context-view__entity__content"},s.a.createElement("div",{className:"monitor-info-context-view__entity__content__id"},this.monitorInfo.id),s.a.createElement(d.Button,{className:"monitor-info-context-view__entity__content__toggle",tooltip:this.state.idCopySuccess?"`已拷贝`":"拷贝监视器 ID",type:"icon",onClick:()=>this.copyMonitorId(this.monitorInfo.id)},this.fetchCopyIcon(this.state.idCopySuccess)))),s.a.createElement("div",{className:"monitor-info-context-view__entity"},s.a.createElement(i.Fragment,null,s.a.createElement("div",{className:"monitor-info-context-view__entity__label"},"创建者"),s.a.createElement("div",{disabled:e,className:e&&"monitor-info-userinfo-offline"},s.a.createElement(_.default,T({},this.monitorInfo.creatorInfo,{containerClass:"monitor-info-context-view__entity__content"}))))),s.a.createElement("div",{className:"monitor-info-context-view__entity"},s.a.createElement("div",{className:"monitor-info-context-view__entity__label"},"创建于"),s.a.createElement("div",{className:"monitor-info-context-view__entity__content"},o)),s.a.createElement("div",{className:"monitor-info-context-view__entity"},s.a.createElement("div",{className:"monitor-info-context-view__entity__label"},"集合"),s.a.createElement("div",{className:"monitor-info-context-view__entity__content monitor-info-context-view__entity__content--collection"},this.state.collectionLoading&&s.a.createElement(a.Text,{color:"content-color-secondary",text:I.LOADING_STATE.generic}),this.monitorInfo.collection&&this.state.collectionInfo?s.a.createElement(s.a.Fragment,null,s.a.createElement(p.default,{to:e?"":{routeIdentifier:"collection.openWithWsSelect",routeParams:{cid:this.monitorInfo.collection}},className:"monitor-info-context-view__entity__content__collection"},e?s.a.createElement(d.Button,{type:"tertiary",className:"monitor-info-btn",disabled:e,tooltip:e&&I.TOOLTIP_TEXT.isOffline},s.a.createElement(N.default,{item:this.state.collectionInfo,hideForkLabelTooltip:!1})):s.a.createElement("div",{className:"monitor-info-text-link"},this.state.collectionInfo&&s.a.createElement(N.default,{type:"link",item:this.state.collectionInfo,hideForkLabelTooltip:!1}))),s.a.createElement("div",{className:"monitor-info-collection__collection-version-tag"},this.state.versionName)):s.a.createElement("span",{className:"monitor-info-context-view__entity__content__collection-empty"},!this.state.collectionLoading&&I.MONITOR_DETAILS_NO_COLLECTION))),s.a.createElement("div",{className:"monitor-info-context-view__entity"},s.a.createElement("div",{className:"monitor-info-context-view__entity__label"},"环境"),s.a.createElement("div",{className:"monitor-info-context-view__entity__content monitor-info-context-view__entity__content--environment"},this.state.environmentLoading&&s.a.createElement(a.Text,{color:"content-color-secondary",text:I.LOADING_STATE.generic}),this.state.environment?s.a.createElement(p.default,{to:e?"":{routeIdentifier:"build.environment",routeParams:{eid:this.monitorInfo.environment}},className:"monitor-info-context-view__entity__content__environment"},e?s.a.createElement(d.Button,{type:"tertiary",className:"monitor-info-btn",disabled:e,tooltip:e&&I.TOOLTIP_TEXT.isOffline},t.get(this.state.environment,"name",null)):s.a.createElement("div",{className:"monitor-info-text-link"},this.state.environment&&s.a.createElement(N.default,{type:"link",item:this.state.environment,hideForkLabelTooltip:!1}))):s.a.createElement("span",{className:"monitor-info-context-view__entity__content__environment-empty"},!this.state.environmentLoading&&I.NO_ENVIRONMENT))),t.includes(["dev","beta","stage","canary","prod"],window.RELEASE_CHANNEL)&&s.a.createElement(E.IntegrationContextBarList,{entityId:this.monitorInfo.id,entityType:"monitor"})))}})||n}.call(this,o("./node_modules/lodash/lodash.js"))}}]);